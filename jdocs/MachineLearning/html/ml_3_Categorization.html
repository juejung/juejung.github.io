<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.39">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>17&nbsp; Machine Learning II: Categorization Algorithm – Machine Learning for Economics</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./ml_4_Classifiers_ch03.html" rel="next">
<link href="./ml_2_OLS.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-e26003cea8cd680ca0c55a263523d882.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-9f23c6a288fd7a0a695a963d2c49d14b.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./ml_1_Intro.html"><strong>Basic Machine Learning</strong></a></li><li class="breadcrumb-item"><a href="./ml_3_Categorization.html"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Machine Learning II: Categorization Algorithm</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Machine Learning for Economics</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text"><strong>Introduction</strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Preface</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ml_0_CourseAdministration.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Course Administration</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text"><strong>ISL Labs</strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch2-statlearning-lab.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Lab Chapter 2: Introduction to Python</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch3-linreg-lab.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Lab Chapter 3: Linear Regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch4-classification-lab.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Lab Chapter 4: Logistic Regression, LDA, QDA, and KNN</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch5-resample-lab.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Lab Chapter 5: Cross-Validation and the Bootstrap</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch6-varselect-lab.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Lab Chapter 6: Linear Models and Regularization Methods</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch7-nonlin-lab.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Lab Chapter 7: Non-Linear Modeling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch8-baggboost-lab.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Lab Chapter 8: Tree-Based Methods</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch9-svm-lab.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Lab Chapter 9: Support Vector Machines</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch10-deeplearning-lab.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Lab Chapter 10: Deep Learning</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch11-surv-lab.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Lab Chapter 11: Survival Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch12-unsup-lab.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Lab Chapter 12: Unsupervised Learning</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch13-multiple-lab.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Lab Chapter 13: Multiple Testing</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text"><strong>Basic Machine Learning</strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ml_1_Intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Machine Learning I: Introduction to Machine Learning</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ml_2_OLS.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Machine Learning: A First Example with OLS</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ml_3_Categorization.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Machine Learning II: Categorization Algorithm</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ml_4_Classifiers_ch03.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">A Tour of Machine Learning Classifiers Using Scikit-Learn</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text"><strong>ML Frameworks</strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ml_PytorchKeras.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Machine Learning Frameworks - Explained</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ml_xx_Assignments.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Assignments</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#a-simple-classification-model" id="toc-a-simple-classification-model" class="nav-link active" data-scroll-target="#a-simple-classification-model"><span class="header-section-number">17.1</span> A Simple Classification Model</a>
  <ul class="collapse">
  <li><a href="#downloading-the-data" id="toc-downloading-the-data" class="nav-link" data-scroll-target="#downloading-the-data"><span class="header-section-number">17.1.1</span> Downloading the Data</a></li>
  <li><a href="#training-the-model" id="toc-training-the-model" class="nav-link" data-scroll-target="#training-the-model"><span class="header-section-number">17.1.2</span> Training the Model</a></li>
  <li><a href="#making-predictions" id="toc-making-predictions" class="nav-link" data-scroll-target="#making-predictions"><span class="header-section-number">17.1.3</span> Making Predictions</a></li>
  <li><a href="#precision-recall-trade-off" id="toc-precision-recall-trade-off" class="nav-link" data-scroll-target="#precision-recall-trade-off"><span class="header-section-number">17.1.4</span> Precision Recall Trade-off</a></li>
  <li><a href="#roc-curves" id="toc-roc-curves" class="nav-link" data-scroll-target="#roc-curves"><span class="header-section-number">17.1.5</span> ROC curves</a></li>
  </ul></li>
  <li><a href="#key-concepts-and-summary" id="toc-key-concepts-and-summary" class="nav-link" data-scroll-target="#key-concepts-and-summary"><span class="header-section-number">17.2</span> Key Concepts and Summary</a></li>
  <li><a href="#self-check-questions" id="toc-self-check-questions" class="nav-link" data-scroll-target="#self-check-questions"><span class="header-section-number">17.3</span> Self-Check Questions</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./ml_1_Intro.html"><strong>Basic Machine Learning</strong></a></li><li class="breadcrumb-item"><a href="./ml_3_Categorization.html"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Machine Learning II: Categorization Algorithm</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Machine Learning II: Categorization Algorithm</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div class="callout callout-style-default callout-tip no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Section Learning Objectives
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Categorization Algorithm</li>
</ul>
</div>
</div>
<p>In this chapter we cover a categorization algorithm that can recognize hand written letters. This is an example of a supervised, batch learning, model based algorithm.</p>
<p>This chapter is heavily built on chapter 3 in <span class="citation" data-cites="Geron_2019_Book">(<a href="references.html#ref-Geron_2019_Book" role="doc-biblioref"><strong>Geron_2019_Book?</strong></a>)</span> “Hands-On Machine Learning with Scikit-Learn, Kera &amp; TensorFlow.” You can find a link to the GitHub page of this textbook at Geron GitHub</p>
<section id="a-simple-classification-model" class="level2" data-number="17.1">
<h2 data-number="17.1" class="anchored" data-anchor-id="a-simple-classification-model"><span class="header-section-number">17.1</span> A Simple Classification Model</h2>
<section id="downloading-the-data" class="level3" data-number="17.1.1">
<h3 data-number="17.1.1" class="anchored" data-anchor-id="downloading-the-data"><span class="header-section-number">17.1.1</span> Downloading the Data</h3>
<p>We first need to import important machine learning libraries.</p>
<div id="00f4b9c8" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.datasets <span class="im">import</span> fetch_openml</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pickle</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib <span class="im">as</span> mpl</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># These are all the functions we use in these codes.</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co"># We import them at the appropriate place further down.</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co">#from sklearn.linear_model import SGDClassifier</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co">#from sklearn.model_selection import cross_val_score</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co">#from sklearn.model_selection import cross_val_predict</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co">#from sklearn.metrics import confusion_matrix</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co">#from sklearn.metrics import precision_score, recall_score</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="co">#from sklearn.metrics import f1_score</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="co">#from sklearn.metrics import precision_recall_curve</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="co">#from sklearn.metrics import roc_curve</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="co">#from sklearn.metrics import roc_auc_score</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="co">#from sklearn.ensemble import RandomForestClassifier</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We next define two functions that will help us save and load data in Python’s pickle format. Think of this as a compressed data format.</p>
<div id="7eded677" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> f_save_obj(obj, name ):</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> <span class="bu">open</span>(name <span class="op">+</span> <span class="st">'.pkl'</span>, <span class="st">'wb'</span>) <span class="im">as</span> f:</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>        pickle.dump(obj, f, pickle.HIGHEST_PROTOCOL)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> f_load_obj(name ):</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> <span class="bu">open</span>(name <span class="op">+</span> <span class="st">'.pkl'</span>, <span class="st">'rb'</span>) <span class="im">as</span> f:</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> pickle.load(f)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We next download the data from an online repository for machine learning data.</p>
<p>The following code sample will use a built in command to download the dataset. It will take a while so be patient:</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<pre><code>```
# Download data: Takes a while. Only do it once.
mnist = fetch_openml('mnist_784', version=1, cache=True)
f_save_obj(mnist, 'mnist_dict_raw') # save dictionary
```</code></pre>
</div>
</div>
<p>The second line is going to save the data as pickle format.</p>
<p>If you don’t want to download the data from the code repository, you can also just downloaded the pickled data from my website Machine_Learning_Number_Data.pkl&lt;Lecture_MachineLearning_2/mnist_dict_raw.pkl&gt;. In my example below, the data is stored in a subfolder called <code>Lecture_MachineLearning_1</code>. After loading the data, we extract the numpy arrays for our labels (y values stored in a vector) and our attributes (X values stored in a matrix, or 2 dimensional array).</p>
<div id="d66075fc" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load data</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>mydata <span class="op">=</span> f_load_obj(<span class="st">'Lecture_MachineLearning_2/mnist_dict_raw'</span>) <span class="co"># load dictionary</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>X, y <span class="op">=</span> mydata[<span class="st">"data"</span>], mydata[<span class="st">"target"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="training-the-model" class="level3" data-number="17.1.2">
<h3 data-number="17.1.2" class="anchored" data-anchor-id="training-the-model"><span class="header-section-number">17.1.2</span> Training the Model</h3>
<p>We can now just check one of the 60,000 digits, say the 36,001 element and plot it using the <code>imshow</code> command from the <code>matplotlib</code> library.</p>
<div id="dca30127" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>some_digit <span class="op">=</span> X[<span class="dv">36000</span>]</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>some_digit_image <span class="op">=</span> some_digit.reshape(<span class="dv">28</span>, <span class="dv">28</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>plt.imshow(some_digit_image, cmap <span class="op">=</span> mpl.cm.binary,</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>           interpolation<span class="op">=</span><span class="st">"nearest"</span>)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>plt.axis(<span class="st">"off"</span>)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="ml_3_Categorization_files/figure-html/cell-5-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1"><img src="ml_3_Categorization_files/figure-html/cell-5-output-1.png" width="389" height="389" class="figure-img"></a></p>
</figure>
</div>
</div>
</div>
<p>As you can see, the 36,001st element is the handwritten number 9.</p>
<p>If you inspect the y-vector you will see that the values are stored as strings. However, all machine learning commands from the <code>skleanr</code> library require numerical inputs. We therefore have to transform the strings into integer numbers.</p>
<div id="43474864" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> y.astype(np.uint8) <span class="co"># label is string, transform into number</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You can now check the type of vector y and convince yourself that it is now a <code>numpy</code> array, i.e., a vector with only integer values.</p>
<p>We next split the sample into a training sample that we use for training (i.e., estimating) our model and into a test sample that we use to evaluate how good our predictions are. We also random shuffle the entries in the training data.</p>
<div id="d03a2840" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> X[:<span class="dv">60000</span>], X[<span class="dv">60000</span>:], y[:<span class="dv">60000</span>], y[<span class="dv">60000</span>:]</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>shuffle_index <span class="op">=</span> np.random.permutation(<span class="dv">60000</span>)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>X_train, y_train <span class="op">=</span> X_train[shuffle_index], y_train[shuffle_index]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For our first exercise, we will train an algorithm that tries to identify the number <code>5</code>. We therefore generate a dummy vector that has only 0 and 1 values in it. It has value 1 whenever the handwritten number is a 5 and it has a value of zero if it is not a handwritten number 5.</p>
<div id="e07e12a8" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Binary classifier</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>y_train_5 <span class="op">=</span> (y_train <span class="op">==</span> <span class="dv">5</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>y_test_5 <span class="op">=</span> (y_test <span class="op">==</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We are now ready to define and subsequently train (i.e., estimate) our model using the training sample, that is the first 60,000 values of the total sample that we downloaded earlier.</p>
<div id="6d875358" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> SGDClassifier</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>sgd_clf <span class="op">=</span> SGDClassifier(max_iter<span class="op">=</span><span class="dv">5</span>, tol<span class="op">=-</span>np.infty, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>sgd_clf.fit(X_train, y_train_5)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">InvalidParameterError</span>                     Traceback (most recent call last)
Cell <span class="ansi-green-fg">In[8], line 3</span>
<span class="ansi-green-fg ansi-bold">      1</span> <span style="font-weight:bold;color:rgb(0,135,0)">from</span> <span style="font-weight:bold;color:rgb(0,0,255)">sklearn</span><span style="font-weight:bold;color:rgb(0,0,255)">.</span><span style="font-weight:bold;color:rgb(0,0,255)">linear_model</span> <span style="font-weight:bold;color:rgb(0,135,0)">import</span> SGDClassifier
<span class="ansi-green-fg ansi-bold">      2</span> sgd_clf <span style="color:rgb(98,98,98)">=</span> SGDClassifier(max_iter<span style="color:rgb(98,98,98)">=</span><span style="color:rgb(98,98,98)">5</span>, tol<span style="color:rgb(98,98,98)">=</span><span style="color:rgb(98,98,98)">-</span>np<span style="color:rgb(98,98,98)">.</span>infty, random_state<span style="color:rgb(98,98,98)">=</span><span style="color:rgb(98,98,98)">42</span>)
<span class="ansi-green-fg">----&gt; 3</span> sgd_clf<span style="color:rgb(98,98,98)">.</span>fit(X_train, y_train_5)

File <span class="ansi-green-fg">~/anaconda3/envs/islp/lib/python3.11/site-packages/sklearn/linear_model/_stochastic_gradient.py:891</span>, in <span class="ansi-cyan-fg">BaseSGDClassifier.fit</span><span class="ansi-blue-fg">(self, X, y, coef_init, intercept_init, sample_weight)</span>
<span class="ansi-green-fg ansi-bold">    863</span> <span style="font-weight:bold;color:rgb(0,135,0)">def</span> <span style="color:rgb(0,0,255)">fit</span>(<span style="color:rgb(0,135,0)">self</span>, X, y, coef_init<span style="color:rgb(98,98,98)">=</span><span style="font-weight:bold;color:rgb(0,135,0)">None</span>, intercept_init<span style="color:rgb(98,98,98)">=</span><span style="font-weight:bold;color:rgb(0,135,0)">None</span>, sample_weight<span style="color:rgb(98,98,98)">=</span><span style="font-weight:bold;color:rgb(0,135,0)">None</span>):
<span class="ansi-green-fg ansi-bold">    864</span> <span style="color:rgb(188,188,188)">    </span><span style="font-style:italic;color:rgb(175,0,0)">"""Fit linear model with Stochastic Gradient Descent.</span>
<span class="ansi-green-fg ansi-bold">    865</span> 
<span class="ansi-green-fg ansi-bold">    866</span> <span style="font-style:italic;color:rgb(175,0,0)">    Parameters</span>
<span class="ansi-green-fg">   (...)</span>
<span class="ansi-green-fg ansi-bold">    889</span> <span style="font-style:italic;color:rgb(175,0,0)">        Returns an instance of self.</span>
<span class="ansi-green-fg ansi-bold">    890</span> <span style="font-style:italic;color:rgb(175,0,0)">    """</span>
<span class="ansi-green-fg">--&gt; 891</span>     <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>_validate_params()
<span class="ansi-green-fg ansi-bold">    892</span>     <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>_more_validate_params()
<span class="ansi-green-fg ansi-bold">    894</span>     <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>_fit(
<span class="ansi-green-fg ansi-bold">    895</span>         X,
<span class="ansi-green-fg ansi-bold">    896</span>         y,
<span class="ansi-green-fg">   (...)</span>
<span class="ansi-green-fg ansi-bold">    903</span>         sample_weight<span style="color:rgb(98,98,98)">=</span>sample_weight,
<span class="ansi-green-fg ansi-bold">    904</span>     )

File <span class="ansi-green-fg">~/anaconda3/envs/islp/lib/python3.11/site-packages/sklearn/base.py:600</span>, in <span class="ansi-cyan-fg">BaseEstimator._validate_params</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-fg ansi-bold">    592</span> <span style="font-weight:bold;color:rgb(0,135,0)">def</span> <span style="color:rgb(0,0,255)">_validate_params</span>(<span style="color:rgb(0,135,0)">self</span>):
<span class="ansi-green-fg ansi-bold">    593</span> <span style="color:rgb(188,188,188)">    </span><span style="font-style:italic;color:rgb(175,0,0)">"""Validate types and values of constructor parameters</span>
<span class="ansi-green-fg ansi-bold">    594</span> 
<span class="ansi-green-fg ansi-bold">    595</span> <span style="font-style:italic;color:rgb(175,0,0)">    The expected type and values must be defined in the `_parameter_constraints`</span>
<span class="ansi-green-fg">   (...)</span>
<span class="ansi-green-fg ansi-bold">    598</span> <span style="font-style:italic;color:rgb(175,0,0)">    accepted constraints.</span>
<span class="ansi-green-fg ansi-bold">    599</span> <span style="font-style:italic;color:rgb(175,0,0)">    """</span>
<span class="ansi-green-fg">--&gt; 600</span>     validate_parameter_constraints(
<span class="ansi-green-fg ansi-bold">    601</span>         <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>_parameter_constraints,
<span class="ansi-green-fg ansi-bold">    602</span>         <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>get_params(deep<span style="color:rgb(98,98,98)">=</span><span style="font-weight:bold;color:rgb(0,135,0)">False</span>),
<span class="ansi-green-fg ansi-bold">    603</span>         caller_name<span style="color:rgb(98,98,98)">=</span><span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span><span style="color:rgb(0,0,135)">__class__</span><span style="color:rgb(98,98,98)">.</span><span style="color:rgb(0,0,135)">__name__</span>,
<span class="ansi-green-fg ansi-bold">    604</span>     )

File <span class="ansi-green-fg">~/anaconda3/envs/islp/lib/python3.11/site-packages/sklearn/utils/_param_validation.py:97</span>, in <span class="ansi-cyan-fg">validate_parameter_constraints</span><span class="ansi-blue-fg">(parameter_constraints, params, caller_name)</span>
<span class="ansi-green-fg ansi-bold">     91</span> <span style="font-weight:bold;color:rgb(0,135,0)">else</span>:
<span class="ansi-green-fg ansi-bold">     92</span>     constraints_str <span style="color:rgb(98,98,98)">=</span> (
<span class="ansi-green-fg ansi-bold">     93</span>         <span style="color:rgb(175,0,0)">f</span><span style="color:rgb(175,0,0)">"</span><span style="font-weight:bold;color:rgb(175,95,135)">{</span><span style="color:rgb(175,0,0)">'</span><span style="color:rgb(175,0,0)">, </span><span style="color:rgb(175,0,0)">'</span><span style="color:rgb(98,98,98)">.</span>join([<span style="color:rgb(0,135,0)">str</span>(c)<span style="color:rgb(188,188,188)"> </span><span style="font-weight:bold;color:rgb(0,135,0)">for</span><span style="color:rgb(188,188,188)"> </span>c<span style="color:rgb(188,188,188)"> </span><span style="font-weight:bold;color:rgb(175,0,255)">in</span><span style="color:rgb(188,188,188)"> </span>constraints[:<span style="color:rgb(98,98,98)">-</span><span style="color:rgb(98,98,98)">1</span>]])<span style="font-weight:bold;color:rgb(175,95,135)">}</span><span style="color:rgb(175,0,0)"> or</span><span style="color:rgb(175,0,0)">"</span>
<span class="ansi-green-fg ansi-bold">     94</span>         <span style="color:rgb(175,0,0)">f</span><span style="color:rgb(175,0,0)">"</span><span style="color:rgb(175,0,0)"> </span><span style="font-weight:bold;color:rgb(175,95,135)">{</span>constraints[<span style="color:rgb(98,98,98)">-</span><span style="color:rgb(98,98,98)">1</span>]<span style="font-weight:bold;color:rgb(175,95,135)">}</span><span style="color:rgb(175,0,0)">"</span>
<span class="ansi-green-fg ansi-bold">     95</span>     )
<span class="ansi-green-fg">---&gt; 97</span> <span style="font-weight:bold;color:rgb(0,135,0)">raise</span> InvalidParameterError(
<span class="ansi-green-fg ansi-bold">     98</span>     <span style="color:rgb(175,0,0)">f</span><span style="color:rgb(175,0,0)">"</span><span style="color:rgb(175,0,0)">The </span><span style="font-weight:bold;color:rgb(175,95,135)">{</span>param_name<span style="font-weight:bold;color:rgb(175,95,135)">!r}</span><span style="color:rgb(175,0,0)"> parameter of </span><span style="font-weight:bold;color:rgb(175,95,135)">{</span>caller_name<span style="font-weight:bold;color:rgb(175,95,135)">}</span><span style="color:rgb(175,0,0)"> must be</span><span style="color:rgb(175,0,0)">"</span>
<span class="ansi-green-fg ansi-bold">     99</span>     <span style="color:rgb(175,0,0)">f</span><span style="color:rgb(175,0,0)">"</span><span style="color:rgb(175,0,0)"> </span><span style="font-weight:bold;color:rgb(175,95,135)">{</span>constraints_str<span style="font-weight:bold;color:rgb(175,95,135)">}</span><span style="color:rgb(175,0,0)">. Got </span><span style="font-weight:bold;color:rgb(175,95,135)">{</span>param_val<span style="font-weight:bold;color:rgb(175,95,135)">!r}</span><span style="color:rgb(175,0,0)"> instead.</span><span style="color:rgb(175,0,0)">"</span>
<span class="ansi-green-fg ansi-bold">    100</span> )

<span class="ansi-red-fg">InvalidParameterError</span>: The 'tol' parameter of SGDClassifier must be a float in the range [0, inf) or None. Got -inf instead.</pre>
</div>
</div>
</div>
</section>
<section id="making-predictions" class="level3" data-number="17.1.3">
<h3 data-number="17.1.3" class="anchored" data-anchor-id="making-predictions"><span class="header-section-number">17.1.3</span> Making Predictions</h3>
<p>We can now use our trained (or estimated) classification model to make predictions of whether a handwritten number might be the number 5 or not. Let’s try this with the 36,001st handwritten number from our training set. We already know that this number is the number 9, but let’s see whether our machine learning algorithm can correctly identify it as not the number 5. Remember, all that our algorithm can regonize at the moment (with some error of course) is the number 5. So if we hand in the pixel data for a handwritten number 9, our prediction should say <code>false</code> because it is NOT the number 5.</p>
<div id="aedaa8fc" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(sgd_clf.predict(some_digit.reshape(<span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NotFittedError</span>                            Traceback (most recent call last)
Cell <span class="ansi-green-fg">In[9], line 1</span>
<span class="ansi-green-fg">----&gt; 1</span> <span style="color:rgb(0,135,0)">print</span>(sgd_clf<span style="color:rgb(98,98,98)">.</span>predict(some_digit<span style="color:rgb(98,98,98)">.</span>reshape(<span style="color:rgb(98,98,98)">1</span>,<span style="color:rgb(98,98,98)">-</span><span style="color:rgb(98,98,98)">1</span>)))

File <span class="ansi-green-fg">~/anaconda3/envs/islp/lib/python3.11/site-packages/sklearn/linear_model/_base.py:419</span>, in <span class="ansi-cyan-fg">LinearClassifierMixin.predict</span><span class="ansi-blue-fg">(self, X)</span>
<span class="ansi-green-fg ansi-bold">    405</span> <span style="font-style:italic;color:rgb(175,0,0)">"""</span>
<span class="ansi-green-fg ansi-bold">    406</span> <span style="font-style:italic;color:rgb(175,0,0)">Predict class labels for samples in X.</span>
<span class="ansi-green-fg ansi-bold">    407</span> 
<span class="ansi-green-fg">   (...)</span>
<span class="ansi-green-fg ansi-bold">    416</span> <span style="font-style:italic;color:rgb(175,0,0)">    Vector containing the class labels for each sample.</span>
<span class="ansi-green-fg ansi-bold">    417</span> <span style="font-style:italic;color:rgb(175,0,0)">"""</span>
<span class="ansi-green-fg ansi-bold">    418</span> xp, _ <span style="color:rgb(98,98,98)">=</span> get_namespace(X)
<span class="ansi-green-fg">--&gt; 419</span> scores <span style="color:rgb(98,98,98)">=</span> <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>decision_function(X)
<span class="ansi-green-fg ansi-bold">    420</span> <span style="font-weight:bold;color:rgb(0,135,0)">if</span> <span style="color:rgb(0,135,0)">len</span>(scores<span style="color:rgb(98,98,98)">.</span>shape) <span style="color:rgb(98,98,98)">==</span> <span style="color:rgb(98,98,98)">1</span>:
<span class="ansi-green-fg ansi-bold">    421</span>     indices <span style="color:rgb(98,98,98)">=</span> xp<span style="color:rgb(98,98,98)">.</span>astype(scores <span style="color:rgb(98,98,98)">&gt;</span> <span style="color:rgb(98,98,98)">0</span>, <span style="color:rgb(0,135,0)">int</span>)

File <span class="ansi-green-fg">~/anaconda3/envs/islp/lib/python3.11/site-packages/sklearn/linear_model/_base.py:397</span>, in <span class="ansi-cyan-fg">LinearClassifierMixin.decision_function</span><span class="ansi-blue-fg">(self, X)</span>
<span class="ansi-green-fg ansi-bold">    378</span> <span style="font-weight:bold;color:rgb(0,135,0)">def</span> <span style="color:rgb(0,0,255)">decision_function</span>(<span style="color:rgb(0,135,0)">self</span>, X):
<span class="ansi-green-fg ansi-bold">    379</span> <span style="color:rgb(188,188,188)">    </span><span style="font-style:italic;color:rgb(175,0,0)">"""</span>
<span class="ansi-green-fg ansi-bold">    380</span> <span style="font-style:italic;color:rgb(175,0,0)">    Predict confidence scores for samples.</span>
<span class="ansi-green-fg ansi-bold">    381</span> 
<span class="ansi-green-fg">   (...)</span>
<span class="ansi-green-fg ansi-bold">    395</span> <span style="font-style:italic;color:rgb(175,0,0)">        this class would be predicted.</span>
<span class="ansi-green-fg ansi-bold">    396</span> <span style="font-style:italic;color:rgb(175,0,0)">    """</span>
<span class="ansi-green-fg">--&gt; 397</span>     check_is_fitted(<span style="color:rgb(0,135,0)">self</span>)
<span class="ansi-green-fg ansi-bold">    398</span>     xp, _ <span style="color:rgb(98,98,98)">=</span> get_namespace(X)
<span class="ansi-green-fg ansi-bold">    400</span>     X <span style="color:rgb(98,98,98)">=</span> <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>_validate_data(X, accept_sparse<span style="color:rgb(98,98,98)">=</span><span style="color:rgb(175,0,0)">"</span><span style="color:rgb(175,0,0)">csr</span><span style="color:rgb(175,0,0)">"</span>, reset<span style="color:rgb(98,98,98)">=</span><span style="font-weight:bold;color:rgb(0,135,0)">False</span>)

File <span class="ansi-green-fg">~/anaconda3/envs/islp/lib/python3.11/site-packages/sklearn/utils/validation.py:1390</span>, in <span class="ansi-cyan-fg">check_is_fitted</span><span class="ansi-blue-fg">(estimator, attributes, msg, all_or_any)</span>
<span class="ansi-green-fg ansi-bold">   1385</span>     fitted <span style="color:rgb(98,98,98)">=</span> [
<span class="ansi-green-fg ansi-bold">   1386</span>         v <span style="font-weight:bold;color:rgb(0,135,0)">for</span> v <span style="font-weight:bold;color:rgb(175,0,255)">in</span> <span style="color:rgb(0,135,0)">vars</span>(estimator) <span style="font-weight:bold;color:rgb(0,135,0)">if</span> v<span style="color:rgb(98,98,98)">.</span>endswith(<span style="color:rgb(175,0,0)">"</span><span style="color:rgb(175,0,0)">_</span><span style="color:rgb(175,0,0)">"</span>) <span style="font-weight:bold;color:rgb(175,0,255)">and</span> <span style="font-weight:bold;color:rgb(175,0,255)">not</span> v<span style="color:rgb(98,98,98)">.</span>startswith(<span style="color:rgb(175,0,0)">"</span><span style="color:rgb(175,0,0)">__</span><span style="color:rgb(175,0,0)">"</span>)
<span class="ansi-green-fg ansi-bold">   1387</span>     ]
<span class="ansi-green-fg ansi-bold">   1389</span> <span style="font-weight:bold;color:rgb(0,135,0)">if</span> <span style="font-weight:bold;color:rgb(175,0,255)">not</span> fitted:
<span class="ansi-green-fg">-&gt; 1390</span>     <span style="font-weight:bold;color:rgb(0,135,0)">raise</span> NotFittedError(msg <span style="color:rgb(98,98,98)">%</span> {<span style="color:rgb(175,0,0)">"</span><span style="color:rgb(175,0,0)">name</span><span style="color:rgb(175,0,0)">"</span>: <span style="color:rgb(0,135,0)">type</span>(estimator)<span style="color:rgb(98,98,98)">.</span><span style="color:rgb(0,0,135)">__name__</span>})

<span class="ansi-red-fg">NotFittedError</span>: This SGDClassifier instance is not fitted yet. Call 'fit' with appropriate arguments before using this estimator.</pre>
</div>
</div>
</div>
<p>Et voila, our trained model has correctly identified the number as NOT 5.</p>
<p>We next run through a battery of checks that determine how well our model can classify handwritten numbers of value 5.</p>
<div id="0c690760" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> cross_val_score</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(cross_val_score(sgd_clf, X_train, y_train_5, cv<span class="op">=</span><span class="dv">3</span>, scoring<span class="op">=</span><span class="st">"accuracy"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">ValueError</span>                                Traceback (most recent call last)
Cell <span class="ansi-green-fg">In[10], line 2</span>
<span class="ansi-green-fg ansi-bold">      1</span> <span style="font-weight:bold;color:rgb(0,135,0)">from</span> <span style="font-weight:bold;color:rgb(0,0,255)">sklearn</span><span style="font-weight:bold;color:rgb(0,0,255)">.</span><span style="font-weight:bold;color:rgb(0,0,255)">model_selection</span> <span style="font-weight:bold;color:rgb(0,135,0)">import</span> cross_val_score
<span class="ansi-green-fg">----&gt; 2</span> <span style="color:rgb(0,135,0)">print</span>(cross_val_score(sgd_clf, X_train, y_train_5, cv<span style="color:rgb(98,98,98)">=</span><span style="color:rgb(98,98,98)">3</span>, scoring<span style="color:rgb(98,98,98)">=</span><span style="color:rgb(175,0,0)">"</span><span style="color:rgb(175,0,0)">accuracy</span><span style="color:rgb(175,0,0)">"</span>))

File <span class="ansi-green-fg">~/anaconda3/envs/islp/lib/python3.11/site-packages/sklearn/model_selection/_validation.py:515</span>, in <span class="ansi-cyan-fg">cross_val_score</span><span class="ansi-blue-fg">(estimator, X, y, groups, scoring, cv, n_jobs, verbose, fit_params, pre_dispatch, error_score)</span>
<span class="ansi-green-fg ansi-bold">    512</span> <span style="font-style:italic;color:rgb(95,135,135)"># To ensure multimetric format is not supported</span>
<span class="ansi-green-fg ansi-bold">    513</span> scorer <span style="color:rgb(98,98,98)">=</span> check_scoring(estimator, scoring<span style="color:rgb(98,98,98)">=</span>scoring)
<span class="ansi-green-fg">--&gt; 515</span> cv_results <span style="color:rgb(98,98,98)">=</span> cross_validate(
<span class="ansi-green-fg ansi-bold">    516</span>     estimator<span style="color:rgb(98,98,98)">=</span>estimator,
<span class="ansi-green-fg ansi-bold">    517</span>     X<span style="color:rgb(98,98,98)">=</span>X,
<span class="ansi-green-fg ansi-bold">    518</span>     y<span style="color:rgb(98,98,98)">=</span>y,
<span class="ansi-green-fg ansi-bold">    519</span>     groups<span style="color:rgb(98,98,98)">=</span>groups,
<span class="ansi-green-fg ansi-bold">    520</span>     scoring<span style="color:rgb(98,98,98)">=</span>{<span style="color:rgb(175,0,0)">"</span><span style="color:rgb(175,0,0)">score</span><span style="color:rgb(175,0,0)">"</span>: scorer},
<span class="ansi-green-fg ansi-bold">    521</span>     cv<span style="color:rgb(98,98,98)">=</span>cv,
<span class="ansi-green-fg ansi-bold">    522</span>     n_jobs<span style="color:rgb(98,98,98)">=</span>n_jobs,
<span class="ansi-green-fg ansi-bold">    523</span>     verbose<span style="color:rgb(98,98,98)">=</span>verbose,
<span class="ansi-green-fg ansi-bold">    524</span>     fit_params<span style="color:rgb(98,98,98)">=</span>fit_params,
<span class="ansi-green-fg ansi-bold">    525</span>     pre_dispatch<span style="color:rgb(98,98,98)">=</span>pre_dispatch,
<span class="ansi-green-fg ansi-bold">    526</span>     error_score<span style="color:rgb(98,98,98)">=</span>error_score,
<span class="ansi-green-fg ansi-bold">    527</span> )
<span class="ansi-green-fg ansi-bold">    528</span> <span style="font-weight:bold;color:rgb(0,135,0)">return</span> cv_results[<span style="color:rgb(175,0,0)">"</span><span style="color:rgb(175,0,0)">test_score</span><span style="color:rgb(175,0,0)">"</span>]

File <span class="ansi-green-fg">~/anaconda3/envs/islp/lib/python3.11/site-packages/sklearn/model_selection/_validation.py:285</span>, in <span class="ansi-cyan-fg">cross_validate</span><span class="ansi-blue-fg">(estimator, X, y, groups, scoring, cv, n_jobs, verbose, fit_params, pre_dispatch, return_train_score, return_estimator, error_score)</span>
<span class="ansi-green-fg ansi-bold">    265</span> parallel <span style="color:rgb(98,98,98)">=</span> Parallel(n_jobs<span style="color:rgb(98,98,98)">=</span>n_jobs, verbose<span style="color:rgb(98,98,98)">=</span>verbose, pre_dispatch<span style="color:rgb(98,98,98)">=</span>pre_dispatch)
<span class="ansi-green-fg ansi-bold">    266</span> results <span style="color:rgb(98,98,98)">=</span> parallel(
<span class="ansi-green-fg ansi-bold">    267</span>     delayed(_fit_and_score)(
<span class="ansi-green-fg ansi-bold">    268</span>         clone(estimator),
<span class="ansi-green-fg">   (...)</span>
<span class="ansi-green-fg ansi-bold">    282</span>     <span style="font-weight:bold;color:rgb(0,135,0)">for</span> train, test <span style="font-weight:bold;color:rgb(175,0,255)">in</span> cv<span style="color:rgb(98,98,98)">.</span>split(X, y, groups)
<span class="ansi-green-fg ansi-bold">    283</span> )
<span class="ansi-green-fg">--&gt; 285</span> _warn_or_raise_about_fit_failures(results, error_score)
<span class="ansi-green-fg ansi-bold">    287</span> <span style="font-style:italic;color:rgb(95,135,135)"># For callabe scoring, the return type is only know after calling. If the</span>
<span class="ansi-green-fg ansi-bold">    288</span> <span style="font-style:italic;color:rgb(95,135,135)"># return type is a dictionary, the error scores can now be inserted with</span>
<span class="ansi-green-fg ansi-bold">    289</span> <span style="font-style:italic;color:rgb(95,135,135)"># the correct key.</span>
<span class="ansi-green-fg ansi-bold">    290</span> <span style="font-weight:bold;color:rgb(0,135,0)">if</span> <span style="color:rgb(0,135,0)">callable</span>(scoring):

File <span class="ansi-green-fg">~/anaconda3/envs/islp/lib/python3.11/site-packages/sklearn/model_selection/_validation.py:367</span>, in <span class="ansi-cyan-fg">_warn_or_raise_about_fit_failures</span><span class="ansi-blue-fg">(results, error_score)</span>
<span class="ansi-green-fg ansi-bold">    360</span> <span style="font-weight:bold;color:rgb(0,135,0)">if</span> num_failed_fits <span style="color:rgb(98,98,98)">==</span> num_fits:
<span class="ansi-green-fg ansi-bold">    361</span>     all_fits_failed_message <span style="color:rgb(98,98,98)">=</span> (
<span class="ansi-green-fg ansi-bold">    362</span>         <span style="color:rgb(175,0,0)">f</span><span style="color:rgb(175,0,0)">"</span><span style="font-weight:bold;color:rgb(175,95,0)">\n</span><span style="color:rgb(175,0,0)">All the </span><span style="font-weight:bold;color:rgb(175,95,135)">{</span>num_fits<span style="font-weight:bold;color:rgb(175,95,135)">}</span><span style="color:rgb(175,0,0)"> fits failed.</span><span style="font-weight:bold;color:rgb(175,95,0)">\n</span><span style="color:rgb(175,0,0)">"</span>
<span class="ansi-green-fg ansi-bold">    363</span>         <span style="color:rgb(175,0,0)">"</span><span style="color:rgb(175,0,0)">It is very likely that your model is misconfigured.</span><span style="font-weight:bold;color:rgb(175,95,0)">\n</span><span style="color:rgb(175,0,0)">"</span>
<span class="ansi-green-fg ansi-bold">    364</span>         <span style="color:rgb(175,0,0)">"</span><span style="color:rgb(175,0,0)">You can try to debug the error by setting error_score=</span><span style="color:rgb(175,0,0)">'</span><span style="color:rgb(175,0,0)">raise</span><span style="color:rgb(175,0,0)">'</span><span style="color:rgb(175,0,0)">.</span><span style="font-weight:bold;color:rgb(175,95,0)">\n</span><span style="font-weight:bold;color:rgb(175,95,0)">\n</span><span style="color:rgb(175,0,0)">"</span>
<span class="ansi-green-fg ansi-bold">    365</span>         <span style="color:rgb(175,0,0)">f</span><span style="color:rgb(175,0,0)">"</span><span style="color:rgb(175,0,0)">Below are more details about the failures:</span><span style="font-weight:bold;color:rgb(175,95,0)">\n</span><span style="font-weight:bold;color:rgb(175,95,135)">{</span>fit_errors_summary<span style="font-weight:bold;color:rgb(175,95,135)">}</span><span style="color:rgb(175,0,0)">"</span>
<span class="ansi-green-fg ansi-bold">    366</span>     )
<span class="ansi-green-fg">--&gt; 367</span>     <span style="font-weight:bold;color:rgb(0,135,0)">raise</span> <span style="font-weight:bold;color:rgb(215,95,95)">ValueError</span>(all_fits_failed_message)
<span class="ansi-green-fg ansi-bold">    369</span> <span style="font-weight:bold;color:rgb(0,135,0)">else</span>:
<span class="ansi-green-fg ansi-bold">    370</span>     some_fits_failed_message <span style="color:rgb(98,98,98)">=</span> (
<span class="ansi-green-fg ansi-bold">    371</span>         <span style="color:rgb(175,0,0)">f</span><span style="color:rgb(175,0,0)">"</span><span style="font-weight:bold;color:rgb(175,95,0)">\n</span><span style="font-weight:bold;color:rgb(175,95,135)">{</span>num_failed_fits<span style="font-weight:bold;color:rgb(175,95,135)">}</span><span style="color:rgb(175,0,0)"> fits failed out of a total of </span><span style="font-weight:bold;color:rgb(175,95,135)">{</span>num_fits<span style="font-weight:bold;color:rgb(175,95,135)">}</span><span style="color:rgb(175,0,0)">.</span><span style="font-weight:bold;color:rgb(175,95,0)">\n</span><span style="color:rgb(175,0,0)">"</span>
<span class="ansi-green-fg ansi-bold">    372</span>         <span style="color:rgb(175,0,0)">"</span><span style="color:rgb(175,0,0)">The score on these train-test partitions for these parameters</span><span style="color:rgb(175,0,0)">"</span>
<span class="ansi-green-fg">   (...)</span>
<span class="ansi-green-fg ansi-bold">    376</span>         <span style="color:rgb(175,0,0)">f</span><span style="color:rgb(175,0,0)">"</span><span style="color:rgb(175,0,0)">Below are more details about the failures:</span><span style="font-weight:bold;color:rgb(175,95,0)">\n</span><span style="font-weight:bold;color:rgb(175,95,135)">{</span>fit_errors_summary<span style="font-weight:bold;color:rgb(175,95,135)">}</span><span style="color:rgb(175,0,0)">"</span>
<span class="ansi-green-fg ansi-bold">    377</span>     )

<span class="ansi-red-fg">ValueError</span>: 
All the 3 fits failed.
It is very likely that your model is misconfigured.
You can try to debug the error by setting error_score='raise'.

Below are more details about the failures:
--------------------------------------------------------------------------------
3 fits failed with the following error:
Traceback (most recent call last):
  File "/home/jjung/anaconda3/envs/islp/lib/python3.11/site-packages/sklearn/model_selection/_validation.py", line 686, in _fit_and_score
    estimator.fit(X_train, y_train, **fit_params)
  File "/home/jjung/anaconda3/envs/islp/lib/python3.11/site-packages/sklearn/linear_model/_stochastic_gradient.py", line 891, in fit
    self._validate_params()
  File "/home/jjung/anaconda3/envs/islp/lib/python3.11/site-packages/sklearn/base.py", line 600, in _validate_params
    validate_parameter_constraints(
  File "/home/jjung/anaconda3/envs/islp/lib/python3.11/site-packages/sklearn/utils/_param_validation.py", line 97, in validate_parameter_constraints
    raise InvalidParameterError(
sklearn.utils._param_validation.InvalidParameterError: The 'tol' parameter of SGDClassifier must be a float in the range [0, inf) or None. Got -inf instead.
</pre>
</div>
</div>
</div>
<div id="4dc05a5b" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> cross_val_predict</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>y_train_pred <span class="op">=</span> cross_val_predict(sgd_clf, X_train, y_train_5, cv<span class="op">=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">InvalidParameterError</span>                     Traceback (most recent call last)
Cell <span class="ansi-green-fg">In[11], line 2</span>
<span class="ansi-green-fg ansi-bold">      1</span> <span style="font-weight:bold;color:rgb(0,135,0)">from</span> <span style="font-weight:bold;color:rgb(0,0,255)">sklearn</span><span style="font-weight:bold;color:rgb(0,0,255)">.</span><span style="font-weight:bold;color:rgb(0,0,255)">model_selection</span> <span style="font-weight:bold;color:rgb(0,135,0)">import</span> cross_val_predict
<span class="ansi-green-fg">----&gt; 2</span> y_train_pred <span style="color:rgb(98,98,98)">=</span> cross_val_predict(sgd_clf, X_train, y_train_5, cv<span style="color:rgb(98,98,98)">=</span><span style="color:rgb(98,98,98)">3</span>)

File <span class="ansi-green-fg">~/anaconda3/envs/islp/lib/python3.11/site-packages/sklearn/model_selection/_validation.py:986</span>, in <span class="ansi-cyan-fg">cross_val_predict</span><span class="ansi-blue-fg">(estimator, X, y, groups, cv, n_jobs, verbose, fit_params, pre_dispatch, method)</span>
<span class="ansi-green-fg ansi-bold">    983</span> <span style="font-style:italic;color:rgb(95,135,135)"># We clone the estimator to make sure that all the folds are</span>
<span class="ansi-green-fg ansi-bold">    984</span> <span style="font-style:italic;color:rgb(95,135,135)"># independent, and that it is pickle-able.</span>
<span class="ansi-green-fg ansi-bold">    985</span> parallel <span style="color:rgb(98,98,98)">=</span> Parallel(n_jobs<span style="color:rgb(98,98,98)">=</span>n_jobs, verbose<span style="color:rgb(98,98,98)">=</span>verbose, pre_dispatch<span style="color:rgb(98,98,98)">=</span>pre_dispatch)
<span class="ansi-green-fg">--&gt; 986</span> predictions <span style="color:rgb(98,98,98)">=</span> parallel(
<span class="ansi-green-fg ansi-bold">    987</span>     delayed(_fit_and_predict)(
<span class="ansi-green-fg ansi-bold">    988</span>         clone(estimator), X, y, train, test, verbose, fit_params, method
<span class="ansi-green-fg ansi-bold">    989</span>     )
<span class="ansi-green-fg ansi-bold">    990</span>     <span style="font-weight:bold;color:rgb(0,135,0)">for</span> train, test <span style="font-weight:bold;color:rgb(175,0,255)">in</span> splits
<span class="ansi-green-fg ansi-bold">    991</span> )
<span class="ansi-green-fg ansi-bold">    993</span> inv_test_indices <span style="color:rgb(98,98,98)">=</span> np<span style="color:rgb(98,98,98)">.</span>empty(<span style="color:rgb(0,135,0)">len</span>(test_indices), dtype<span style="color:rgb(98,98,98)">=</span><span style="color:rgb(0,135,0)">int</span>)
<span class="ansi-green-fg ansi-bold">    994</span> inv_test_indices[test_indices] <span style="color:rgb(98,98,98)">=</span> np<span style="color:rgb(98,98,98)">.</span>arange(<span style="color:rgb(0,135,0)">len</span>(test_indices))

File <span class="ansi-green-fg">~/anaconda3/envs/islp/lib/python3.11/site-packages/sklearn/utils/parallel.py:63</span>, in <span class="ansi-cyan-fg">Parallel.__call__</span><span class="ansi-blue-fg">(self, iterable)</span>
<span class="ansi-green-fg ansi-bold">     58</span> config <span style="color:rgb(98,98,98)">=</span> get_config()
<span class="ansi-green-fg ansi-bold">     59</span> iterable_with_config <span style="color:rgb(98,98,98)">=</span> (
<span class="ansi-green-fg ansi-bold">     60</span>     (_with_config(delayed_func, config), args, kwargs)
<span class="ansi-green-fg ansi-bold">     61</span>     <span style="font-weight:bold;color:rgb(0,135,0)">for</span> delayed_func, args, kwargs <span style="font-weight:bold;color:rgb(175,0,255)">in</span> iterable
<span class="ansi-green-fg ansi-bold">     62</span> )
<span class="ansi-green-fg">---&gt; 63</span> <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span style="color:rgb(0,135,0)">super</span>()<span style="color:rgb(98,98,98)">.</span><span style="color:rgb(0,0,255)">__call__</span>(iterable_with_config)

File <span class="ansi-green-fg">~/anaconda3/envs/islp/lib/python3.11/site-packages/joblib/parallel.py:1085</span>, in <span class="ansi-cyan-fg">Parallel.__call__</span><span class="ansi-blue-fg">(self, iterable)</span>
<span class="ansi-green-fg ansi-bold">   1076</span> <span style="font-weight:bold;color:rgb(0,135,0)">try</span>:
<span class="ansi-green-fg ansi-bold">   1077</span>     <span style="font-style:italic;color:rgb(95,135,135)"># Only set self._iterating to True if at least a batch</span>
<span class="ansi-green-fg ansi-bold">   1078</span>     <span style="font-style:italic;color:rgb(95,135,135)"># was dispatched. In particular this covers the edge</span>
<span class="ansi-green-fg">   (...)</span>
<span class="ansi-green-fg ansi-bold">   1082</span>     <span style="font-style:italic;color:rgb(95,135,135)"># was very quick and its callback already dispatched all the</span>
<span class="ansi-green-fg ansi-bold">   1083</span>     <span style="font-style:italic;color:rgb(95,135,135)"># remaining jobs.</span>
<span class="ansi-green-fg ansi-bold">   1084</span>     <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>_iterating <span style="color:rgb(98,98,98)">=</span> <span style="font-weight:bold;color:rgb(0,135,0)">False</span>
<span class="ansi-green-fg">-&gt; 1085</span>     <span style="font-weight:bold;color:rgb(0,135,0)">if</span> <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>dispatch_one_batch(iterator):
<span class="ansi-green-fg ansi-bold">   1086</span>         <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>_iterating <span style="color:rgb(98,98,98)">=</span> <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>_original_iterator <span style="font-weight:bold;color:rgb(175,0,255)">is</span> <span style="font-weight:bold;color:rgb(175,0,255)">not</span> <span style="font-weight:bold;color:rgb(0,135,0)">None</span>
<span class="ansi-green-fg ansi-bold">   1088</span>     <span style="font-weight:bold;color:rgb(0,135,0)">while</span> <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>dispatch_one_batch(iterator):

File <span class="ansi-green-fg">~/anaconda3/envs/islp/lib/python3.11/site-packages/joblib/parallel.py:901</span>, in <span class="ansi-cyan-fg">Parallel.dispatch_one_batch</span><span class="ansi-blue-fg">(self, iterator)</span>
<span class="ansi-green-fg ansi-bold">    899</span>     <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span style="font-weight:bold;color:rgb(0,135,0)">False</span>
<span class="ansi-green-fg ansi-bold">    900</span> <span style="font-weight:bold;color:rgb(0,135,0)">else</span>:
<span class="ansi-green-fg">--&gt; 901</span>     <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>_dispatch(tasks)
<span class="ansi-green-fg ansi-bold">    902</span>     <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span style="font-weight:bold;color:rgb(0,135,0)">True</span>

File <span class="ansi-green-fg">~/anaconda3/envs/islp/lib/python3.11/site-packages/joblib/parallel.py:819</span>, in <span class="ansi-cyan-fg">Parallel._dispatch</span><span class="ansi-blue-fg">(self, batch)</span>
<span class="ansi-green-fg ansi-bold">    817</span> <span style="font-weight:bold;color:rgb(0,135,0)">with</span> <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>_lock:
<span class="ansi-green-fg ansi-bold">    818</span>     job_idx <span style="color:rgb(98,98,98)">=</span> <span style="color:rgb(0,135,0)">len</span>(<span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>_jobs)
<span class="ansi-green-fg">--&gt; 819</span>     job <span style="color:rgb(98,98,98)">=</span> <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>_backend<span style="color:rgb(98,98,98)">.</span>apply_async(batch, callback<span style="color:rgb(98,98,98)">=</span>cb)
<span class="ansi-green-fg ansi-bold">    820</span>     <span style="font-style:italic;color:rgb(95,135,135)"># A job can complete so quickly than its callback is</span>
<span class="ansi-green-fg ansi-bold">    821</span>     <span style="font-style:italic;color:rgb(95,135,135)"># called before we get here, causing self._jobs to</span>
<span class="ansi-green-fg ansi-bold">    822</span>     <span style="font-style:italic;color:rgb(95,135,135)"># grow. To ensure correct results ordering, .insert is</span>
<span class="ansi-green-fg ansi-bold">    823</span>     <span style="font-style:italic;color:rgb(95,135,135)"># used (rather than .append) in the following line</span>
<span class="ansi-green-fg ansi-bold">    824</span>     <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>_jobs<span style="color:rgb(98,98,98)">.</span>insert(job_idx, job)

File <span class="ansi-green-fg">~/anaconda3/envs/islp/lib/python3.11/site-packages/joblib/_parallel_backends.py:208</span>, in <span class="ansi-cyan-fg">SequentialBackend.apply_async</span><span class="ansi-blue-fg">(self, func, callback)</span>
<span class="ansi-green-fg ansi-bold">    206</span> <span style="font-weight:bold;color:rgb(0,135,0)">def</span> <span style="color:rgb(0,0,255)">apply_async</span>(<span style="color:rgb(0,135,0)">self</span>, func, callback<span style="color:rgb(98,98,98)">=</span><span style="font-weight:bold;color:rgb(0,135,0)">None</span>):
<span class="ansi-green-fg ansi-bold">    207</span> <span style="color:rgb(188,188,188)">    </span><span style="font-style:italic;color:rgb(175,0,0)">"""Schedule a func to be run"""</span>
<span class="ansi-green-fg">--&gt; 208</span>     result <span style="color:rgb(98,98,98)">=</span> ImmediateResult(func)
<span class="ansi-green-fg ansi-bold">    209</span>     <span style="font-weight:bold;color:rgb(0,135,0)">if</span> callback:
<span class="ansi-green-fg ansi-bold">    210</span>         callback(result)

File <span class="ansi-green-fg">~/anaconda3/envs/islp/lib/python3.11/site-packages/joblib/_parallel_backends.py:597</span>, in <span class="ansi-cyan-fg">ImmediateResult.__init__</span><span class="ansi-blue-fg">(self, batch)</span>
<span class="ansi-green-fg ansi-bold">    594</span> <span style="font-weight:bold;color:rgb(0,135,0)">def</span> <span style="color:rgb(0,0,255)">__init__</span>(<span style="color:rgb(0,135,0)">self</span>, batch):
<span class="ansi-green-fg ansi-bold">    595</span>     <span style="font-style:italic;color:rgb(95,135,135)"># Don't delay the application, to avoid keeping the input</span>
<span class="ansi-green-fg ansi-bold">    596</span>     <span style="font-style:italic;color:rgb(95,135,135)"># arguments in memory</span>
<span class="ansi-green-fg">--&gt; 597</span>     <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>results <span style="color:rgb(98,98,98)">=</span> batch()

File <span class="ansi-green-fg">~/anaconda3/envs/islp/lib/python3.11/site-packages/joblib/parallel.py:288</span>, in <span class="ansi-cyan-fg">BatchedCalls.__call__</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-fg ansi-bold">    284</span> <span style="font-weight:bold;color:rgb(0,135,0)">def</span> <span style="color:rgb(0,0,255)">__call__</span>(<span style="color:rgb(0,135,0)">self</span>):
<span class="ansi-green-fg ansi-bold">    285</span>     <span style="font-style:italic;color:rgb(95,135,135)"># Set the default nested backend to self._backend but do not set the</span>
<span class="ansi-green-fg ansi-bold">    286</span>     <span style="font-style:italic;color:rgb(95,135,135)"># change the default number of processes to -1</span>
<span class="ansi-green-fg ansi-bold">    287</span>     <span style="font-weight:bold;color:rgb(0,135,0)">with</span> parallel_backend(<span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>_backend, n_jobs<span style="color:rgb(98,98,98)">=</span><span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>_n_jobs):
<span class="ansi-green-fg">--&gt; 288</span>         <span style="font-weight:bold;color:rgb(0,135,0)">return</span> [func(<span style="color:rgb(98,98,98)">*</span>args, <span style="color:rgb(98,98,98)">*</span><span style="color:rgb(98,98,98)">*</span>kwargs)
<span class="ansi-green-fg ansi-bold">    289</span>                 <span style="font-weight:bold;color:rgb(0,135,0)">for</span> func, args, kwargs <span style="font-weight:bold;color:rgb(175,0,255)">in</span> <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>items]

File <span class="ansi-green-fg">~/anaconda3/envs/islp/lib/python3.11/site-packages/joblib/parallel.py:288</span>, in <span class="ansi-cyan-fg">&lt;listcomp&gt;</span><span class="ansi-blue-fg">(.0)</span>
<span class="ansi-green-fg ansi-bold">    284</span> <span style="font-weight:bold;color:rgb(0,135,0)">def</span> <span style="color:rgb(0,0,255)">__call__</span>(<span style="color:rgb(0,135,0)">self</span>):
<span class="ansi-green-fg ansi-bold">    285</span>     <span style="font-style:italic;color:rgb(95,135,135)"># Set the default nested backend to self._backend but do not set the</span>
<span class="ansi-green-fg ansi-bold">    286</span>     <span style="font-style:italic;color:rgb(95,135,135)"># change the default number of processes to -1</span>
<span class="ansi-green-fg ansi-bold">    287</span>     <span style="font-weight:bold;color:rgb(0,135,0)">with</span> parallel_backend(<span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>_backend, n_jobs<span style="color:rgb(98,98,98)">=</span><span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>_n_jobs):
<span class="ansi-green-fg">--&gt; 288</span>         <span style="font-weight:bold;color:rgb(0,135,0)">return</span> [func(<span style="color:rgb(98,98,98)">*</span>args, <span style="color:rgb(98,98,98)">*</span><span style="color:rgb(98,98,98)">*</span>kwargs)
<span class="ansi-green-fg ansi-bold">    289</span>                 <span style="font-weight:bold;color:rgb(0,135,0)">for</span> func, args, kwargs <span style="font-weight:bold;color:rgb(175,0,255)">in</span> <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>items]

File <span class="ansi-green-fg">~/anaconda3/envs/islp/lib/python3.11/site-packages/sklearn/utils/parallel.py:123</span>, in <span class="ansi-cyan-fg">_FuncWrapper.__call__</span><span class="ansi-blue-fg">(self, *args, **kwargs)</span>
<span class="ansi-green-fg ansi-bold">    121</span>     config <span style="color:rgb(98,98,98)">=</span> {}
<span class="ansi-green-fg ansi-bold">    122</span> <span style="font-weight:bold;color:rgb(0,135,0)">with</span> config_context(<span style="color:rgb(98,98,98)">*</span><span style="color:rgb(98,98,98)">*</span>config):
<span class="ansi-green-fg">--&gt; 123</span>     <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>function(<span style="color:rgb(98,98,98)">*</span>args, <span style="color:rgb(98,98,98)">*</span><span style="color:rgb(98,98,98)">*</span>kwargs)

File <span class="ansi-green-fg">~/anaconda3/envs/islp/lib/python3.11/site-packages/sklearn/model_selection/_validation.py:1068</span>, in <span class="ansi-cyan-fg">_fit_and_predict</span><span class="ansi-blue-fg">(estimator, X, y, train, test, verbose, fit_params, method)</span>
<span class="ansi-green-fg ansi-bold">   1066</span>     estimator<span style="color:rgb(98,98,98)">.</span>fit(X_train, <span style="color:rgb(98,98,98)">*</span><span style="color:rgb(98,98,98)">*</span>fit_params)
<span class="ansi-green-fg ansi-bold">   1067</span> <span style="font-weight:bold;color:rgb(0,135,0)">else</span>:
<span class="ansi-green-fg">-&gt; 1068</span>     estimator<span style="color:rgb(98,98,98)">.</span>fit(X_train, y_train, <span style="color:rgb(98,98,98)">*</span><span style="color:rgb(98,98,98)">*</span>fit_params)
<span class="ansi-green-fg ansi-bold">   1069</span> func <span style="color:rgb(98,98,98)">=</span> <span style="color:rgb(0,135,0)">getattr</span>(estimator, method)
<span class="ansi-green-fg ansi-bold">   1070</span> predictions <span style="color:rgb(98,98,98)">=</span> func(X_test)

File <span class="ansi-green-fg">~/anaconda3/envs/islp/lib/python3.11/site-packages/sklearn/linear_model/_stochastic_gradient.py:891</span>, in <span class="ansi-cyan-fg">BaseSGDClassifier.fit</span><span class="ansi-blue-fg">(self, X, y, coef_init, intercept_init, sample_weight)</span>
<span class="ansi-green-fg ansi-bold">    863</span> <span style="font-weight:bold;color:rgb(0,135,0)">def</span> <span style="color:rgb(0,0,255)">fit</span>(<span style="color:rgb(0,135,0)">self</span>, X, y, coef_init<span style="color:rgb(98,98,98)">=</span><span style="font-weight:bold;color:rgb(0,135,0)">None</span>, intercept_init<span style="color:rgb(98,98,98)">=</span><span style="font-weight:bold;color:rgb(0,135,0)">None</span>, sample_weight<span style="color:rgb(98,98,98)">=</span><span style="font-weight:bold;color:rgb(0,135,0)">None</span>):
<span class="ansi-green-fg ansi-bold">    864</span> <span style="color:rgb(188,188,188)">    </span><span style="font-style:italic;color:rgb(175,0,0)">"""Fit linear model with Stochastic Gradient Descent.</span>
<span class="ansi-green-fg ansi-bold">    865</span> 
<span class="ansi-green-fg ansi-bold">    866</span> <span style="font-style:italic;color:rgb(175,0,0)">    Parameters</span>
<span class="ansi-green-fg">   (...)</span>
<span class="ansi-green-fg ansi-bold">    889</span> <span style="font-style:italic;color:rgb(175,0,0)">        Returns an instance of self.</span>
<span class="ansi-green-fg ansi-bold">    890</span> <span style="font-style:italic;color:rgb(175,0,0)">    """</span>
<span class="ansi-green-fg">--&gt; 891</span>     <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>_validate_params()
<span class="ansi-green-fg ansi-bold">    892</span>     <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>_more_validate_params()
<span class="ansi-green-fg ansi-bold">    894</span>     <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>_fit(
<span class="ansi-green-fg ansi-bold">    895</span>         X,
<span class="ansi-green-fg ansi-bold">    896</span>         y,
<span class="ansi-green-fg">   (...)</span>
<span class="ansi-green-fg ansi-bold">    903</span>         sample_weight<span style="color:rgb(98,98,98)">=</span>sample_weight,
<span class="ansi-green-fg ansi-bold">    904</span>     )

File <span class="ansi-green-fg">~/anaconda3/envs/islp/lib/python3.11/site-packages/sklearn/base.py:600</span>, in <span class="ansi-cyan-fg">BaseEstimator._validate_params</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-fg ansi-bold">    592</span> <span style="font-weight:bold;color:rgb(0,135,0)">def</span> <span style="color:rgb(0,0,255)">_validate_params</span>(<span style="color:rgb(0,135,0)">self</span>):
<span class="ansi-green-fg ansi-bold">    593</span> <span style="color:rgb(188,188,188)">    </span><span style="font-style:italic;color:rgb(175,0,0)">"""Validate types and values of constructor parameters</span>
<span class="ansi-green-fg ansi-bold">    594</span> 
<span class="ansi-green-fg ansi-bold">    595</span> <span style="font-style:italic;color:rgb(175,0,0)">    The expected type and values must be defined in the `_parameter_constraints`</span>
<span class="ansi-green-fg">   (...)</span>
<span class="ansi-green-fg ansi-bold">    598</span> <span style="font-style:italic;color:rgb(175,0,0)">    accepted constraints.</span>
<span class="ansi-green-fg ansi-bold">    599</span> <span style="font-style:italic;color:rgb(175,0,0)">    """</span>
<span class="ansi-green-fg">--&gt; 600</span>     validate_parameter_constraints(
<span class="ansi-green-fg ansi-bold">    601</span>         <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>_parameter_constraints,
<span class="ansi-green-fg ansi-bold">    602</span>         <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>get_params(deep<span style="color:rgb(98,98,98)">=</span><span style="font-weight:bold;color:rgb(0,135,0)">False</span>),
<span class="ansi-green-fg ansi-bold">    603</span>         caller_name<span style="color:rgb(98,98,98)">=</span><span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span><span style="color:rgb(0,0,135)">__class__</span><span style="color:rgb(98,98,98)">.</span><span style="color:rgb(0,0,135)">__name__</span>,
<span class="ansi-green-fg ansi-bold">    604</span>     )

File <span class="ansi-green-fg">~/anaconda3/envs/islp/lib/python3.11/site-packages/sklearn/utils/_param_validation.py:97</span>, in <span class="ansi-cyan-fg">validate_parameter_constraints</span><span class="ansi-blue-fg">(parameter_constraints, params, caller_name)</span>
<span class="ansi-green-fg ansi-bold">     91</span> <span style="font-weight:bold;color:rgb(0,135,0)">else</span>:
<span class="ansi-green-fg ansi-bold">     92</span>     constraints_str <span style="color:rgb(98,98,98)">=</span> (
<span class="ansi-green-fg ansi-bold">     93</span>         <span style="color:rgb(175,0,0)">f</span><span style="color:rgb(175,0,0)">"</span><span style="font-weight:bold;color:rgb(175,95,135)">{</span><span style="color:rgb(175,0,0)">'</span><span style="color:rgb(175,0,0)">, </span><span style="color:rgb(175,0,0)">'</span><span style="color:rgb(98,98,98)">.</span>join([<span style="color:rgb(0,135,0)">str</span>(c)<span style="color:rgb(188,188,188)"> </span><span style="font-weight:bold;color:rgb(0,135,0)">for</span><span style="color:rgb(188,188,188)"> </span>c<span style="color:rgb(188,188,188)"> </span><span style="font-weight:bold;color:rgb(175,0,255)">in</span><span style="color:rgb(188,188,188)"> </span>constraints[:<span style="color:rgb(98,98,98)">-</span><span style="color:rgb(98,98,98)">1</span>]])<span style="font-weight:bold;color:rgb(175,95,135)">}</span><span style="color:rgb(175,0,0)"> or</span><span style="color:rgb(175,0,0)">"</span>
<span class="ansi-green-fg ansi-bold">     94</span>         <span style="color:rgb(175,0,0)">f</span><span style="color:rgb(175,0,0)">"</span><span style="color:rgb(175,0,0)"> </span><span style="font-weight:bold;color:rgb(175,95,135)">{</span>constraints[<span style="color:rgb(98,98,98)">-</span><span style="color:rgb(98,98,98)">1</span>]<span style="font-weight:bold;color:rgb(175,95,135)">}</span><span style="color:rgb(175,0,0)">"</span>
<span class="ansi-green-fg ansi-bold">     95</span>     )
<span class="ansi-green-fg">---&gt; 97</span> <span style="font-weight:bold;color:rgb(0,135,0)">raise</span> InvalidParameterError(
<span class="ansi-green-fg ansi-bold">     98</span>     <span style="color:rgb(175,0,0)">f</span><span style="color:rgb(175,0,0)">"</span><span style="color:rgb(175,0,0)">The </span><span style="font-weight:bold;color:rgb(175,95,135)">{</span>param_name<span style="font-weight:bold;color:rgb(175,95,135)">!r}</span><span style="color:rgb(175,0,0)"> parameter of </span><span style="font-weight:bold;color:rgb(175,95,135)">{</span>caller_name<span style="font-weight:bold;color:rgb(175,95,135)">}</span><span style="color:rgb(175,0,0)"> must be</span><span style="color:rgb(175,0,0)">"</span>
<span class="ansi-green-fg ansi-bold">     99</span>     <span style="color:rgb(175,0,0)">f</span><span style="color:rgb(175,0,0)">"</span><span style="color:rgb(175,0,0)"> </span><span style="font-weight:bold;color:rgb(175,95,135)">{</span>constraints_str<span style="font-weight:bold;color:rgb(175,95,135)">}</span><span style="color:rgb(175,0,0)">. Got </span><span style="font-weight:bold;color:rgb(175,95,135)">{</span>param_val<span style="font-weight:bold;color:rgb(175,95,135)">!r}</span><span style="color:rgb(175,0,0)"> instead.</span><span style="color:rgb(175,0,0)">"</span>
<span class="ansi-green-fg ansi-bold">    100</span> )

<span class="ansi-red-fg">InvalidParameterError</span>: The 'tol' parameter of SGDClassifier must be a float in the range [0, inf) or None. Got -inf instead.</pre>
</div>
</div>
</div>
<div id="4f0d5057" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> confusion_matrix</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(confusion_matrix(y_train_5, y_train_pred))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
Cell <span class="ansi-green-fg">In[12], line 2</span>
<span class="ansi-green-fg ansi-bold">      1</span> <span style="font-weight:bold;color:rgb(0,135,0)">from</span> <span style="font-weight:bold;color:rgb(0,0,255)">sklearn</span><span style="font-weight:bold;color:rgb(0,0,255)">.</span><span style="font-weight:bold;color:rgb(0,0,255)">metrics</span> <span style="font-weight:bold;color:rgb(0,135,0)">import</span> confusion_matrix
<span class="ansi-green-fg">----&gt; 2</span> <span style="color:rgb(0,135,0)">print</span>(confusion_matrix(y_train_5, y_train_pred))

<span class="ansi-red-fg">NameError</span>: name 'y_train_pred' is not defined</pre>
</div>
</div>
</div>
<div id="1cdc8743" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>y_train_perfect_predictions <span class="op">=</span> y_train_5</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(confusion_matrix(y_train_5, y_train_perfect_predictions))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[54579     0]
 [    0  5421]]</code></pre>
</div>
</div>
<div id="cd409a25" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> precision_score, recall_score</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(precision_score(y_train_5, y_train_pred))</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(recall_score(y_train_5, y_train_pred))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
Cell <span class="ansi-green-fg">In[14], line 2</span>
<span class="ansi-green-fg ansi-bold">      1</span> <span style="font-weight:bold;color:rgb(0,135,0)">from</span> <span style="font-weight:bold;color:rgb(0,0,255)">sklearn</span><span style="font-weight:bold;color:rgb(0,0,255)">.</span><span style="font-weight:bold;color:rgb(0,0,255)">metrics</span> <span style="font-weight:bold;color:rgb(0,135,0)">import</span> precision_score, recall_score
<span class="ansi-green-fg">----&gt; 2</span> <span style="color:rgb(0,135,0)">print</span>(precision_score(y_train_5, y_train_pred))
<span class="ansi-green-fg ansi-bold">      3</span> <span style="color:rgb(0,135,0)">print</span>(recall_score(y_train_5, y_train_pred))

<span class="ansi-red-fg">NameError</span>: name 'y_train_pred' is not defined</pre>
</div>
</div>
</div>
<div id="3365037b" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> f1_score</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(f1_score(y_train_5, y_train_pred))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
Cell <span class="ansi-green-fg">In[15], line 2</span>
<span class="ansi-green-fg ansi-bold">      1</span> <span style="font-weight:bold;color:rgb(0,135,0)">from</span> <span style="font-weight:bold;color:rgb(0,0,255)">sklearn</span><span style="font-weight:bold;color:rgb(0,0,255)">.</span><span style="font-weight:bold;color:rgb(0,0,255)">metrics</span> <span style="font-weight:bold;color:rgb(0,135,0)">import</span> f1_score
<span class="ansi-green-fg">----&gt; 2</span> <span style="color:rgb(0,135,0)">print</span>(f1_score(y_train_5, y_train_pred))

<span class="ansi-red-fg">NameError</span>: name 'y_train_pred' is not defined</pre>
</div>
</div>
</div>
</section>
<section id="precision-recall-trade-off" class="level3" data-number="17.1.4">
<h3 data-number="17.1.4" class="anchored" data-anchor-id="precision-recall-trade-off"><span class="header-section-number">17.1.4</span> Precision Recall Trade-off</h3>
<div id="0be80013" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>y_scores <span class="op">=</span> sgd_clf.decision_function([some_digit])</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(y_scores)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NotFittedError</span>                            Traceback (most recent call last)
Cell <span class="ansi-green-fg">In[16], line 1</span>
<span class="ansi-green-fg">----&gt; 1</span> y_scores <span style="color:rgb(98,98,98)">=</span> sgd_clf<span style="color:rgb(98,98,98)">.</span>decision_function([some_digit])
<span class="ansi-green-fg ansi-bold">      2</span> <span style="color:rgb(0,135,0)">print</span>(y_scores)

File <span class="ansi-green-fg">~/anaconda3/envs/islp/lib/python3.11/site-packages/sklearn/linear_model/_base.py:397</span>, in <span class="ansi-cyan-fg">LinearClassifierMixin.decision_function</span><span class="ansi-blue-fg">(self, X)</span>
<span class="ansi-green-fg ansi-bold">    378</span> <span style="font-weight:bold;color:rgb(0,135,0)">def</span> <span style="color:rgb(0,0,255)">decision_function</span>(<span style="color:rgb(0,135,0)">self</span>, X):
<span class="ansi-green-fg ansi-bold">    379</span> <span style="color:rgb(188,188,188)">    </span><span style="font-style:italic;color:rgb(175,0,0)">"""</span>
<span class="ansi-green-fg ansi-bold">    380</span> <span style="font-style:italic;color:rgb(175,0,0)">    Predict confidence scores for samples.</span>
<span class="ansi-green-fg ansi-bold">    381</span> 
<span class="ansi-green-fg">   (...)</span>
<span class="ansi-green-fg ansi-bold">    395</span> <span style="font-style:italic;color:rgb(175,0,0)">        this class would be predicted.</span>
<span class="ansi-green-fg ansi-bold">    396</span> <span style="font-style:italic;color:rgb(175,0,0)">    """</span>
<span class="ansi-green-fg">--&gt; 397</span>     check_is_fitted(<span style="color:rgb(0,135,0)">self</span>)
<span class="ansi-green-fg ansi-bold">    398</span>     xp, _ <span style="color:rgb(98,98,98)">=</span> get_namespace(X)
<span class="ansi-green-fg ansi-bold">    400</span>     X <span style="color:rgb(98,98,98)">=</span> <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>_validate_data(X, accept_sparse<span style="color:rgb(98,98,98)">=</span><span style="color:rgb(175,0,0)">"</span><span style="color:rgb(175,0,0)">csr</span><span style="color:rgb(175,0,0)">"</span>, reset<span style="color:rgb(98,98,98)">=</span><span style="font-weight:bold;color:rgb(0,135,0)">False</span>)

File <span class="ansi-green-fg">~/anaconda3/envs/islp/lib/python3.11/site-packages/sklearn/utils/validation.py:1390</span>, in <span class="ansi-cyan-fg">check_is_fitted</span><span class="ansi-blue-fg">(estimator, attributes, msg, all_or_any)</span>
<span class="ansi-green-fg ansi-bold">   1385</span>     fitted <span style="color:rgb(98,98,98)">=</span> [
<span class="ansi-green-fg ansi-bold">   1386</span>         v <span style="font-weight:bold;color:rgb(0,135,0)">for</span> v <span style="font-weight:bold;color:rgb(175,0,255)">in</span> <span style="color:rgb(0,135,0)">vars</span>(estimator) <span style="font-weight:bold;color:rgb(0,135,0)">if</span> v<span style="color:rgb(98,98,98)">.</span>endswith(<span style="color:rgb(175,0,0)">"</span><span style="color:rgb(175,0,0)">_</span><span style="color:rgb(175,0,0)">"</span>) <span style="font-weight:bold;color:rgb(175,0,255)">and</span> <span style="font-weight:bold;color:rgb(175,0,255)">not</span> v<span style="color:rgb(98,98,98)">.</span>startswith(<span style="color:rgb(175,0,0)">"</span><span style="color:rgb(175,0,0)">__</span><span style="color:rgb(175,0,0)">"</span>)
<span class="ansi-green-fg ansi-bold">   1387</span>     ]
<span class="ansi-green-fg ansi-bold">   1389</span> <span style="font-weight:bold;color:rgb(0,135,0)">if</span> <span style="font-weight:bold;color:rgb(175,0,255)">not</span> fitted:
<span class="ansi-green-fg">-&gt; 1390</span>     <span style="font-weight:bold;color:rgb(0,135,0)">raise</span> NotFittedError(msg <span style="color:rgb(98,98,98)">%</span> {<span style="color:rgb(175,0,0)">"</span><span style="color:rgb(175,0,0)">name</span><span style="color:rgb(175,0,0)">"</span>: <span style="color:rgb(0,135,0)">type</span>(estimator)<span style="color:rgb(98,98,98)">.</span><span style="color:rgb(0,0,135)">__name__</span>})

<span class="ansi-red-fg">NotFittedError</span>: This SGDClassifier instance is not fitted yet. Call 'fit' with appropriate arguments before using this estimator.</pre>
</div>
</div>
</div>
<div id="442ea85f" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>threshold <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>y_some_digit_pred <span class="op">=</span> (y_scores <span class="op">&gt;</span> threshold)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(y_some_digit_pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
Cell <span class="ansi-green-fg">In[17], line 2</span>
<span class="ansi-green-fg ansi-bold">      1</span> threshold <span style="color:rgb(98,98,98)">=</span> <span style="color:rgb(98,98,98)">0</span>
<span class="ansi-green-fg">----&gt; 2</span> y_some_digit_pred <span style="color:rgb(98,98,98)">=</span> (y_scores <span style="color:rgb(98,98,98)">&gt;</span> threshold)
<span class="ansi-green-fg ansi-bold">      3</span> <span style="color:rgb(0,135,0)">print</span>(y_some_digit_pred)

<span class="ansi-red-fg">NameError</span>: name 'y_scores' is not defined</pre>
</div>
</div>
</div>
<div id="ed3727fd" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>threshold <span class="op">=</span> <span class="dv">200000</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>y_some_digit_pred <span class="op">=</span> (y_scores <span class="op">&gt;</span> threshold)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(y_some_digit_pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
Cell <span class="ansi-green-fg">In[18], line 2</span>
<span class="ansi-green-fg ansi-bold">      1</span> threshold <span style="color:rgb(98,98,98)">=</span> <span style="color:rgb(98,98,98)">200000</span>
<span class="ansi-green-fg">----&gt; 2</span> y_some_digit_pred <span style="color:rgb(98,98,98)">=</span> (y_scores <span style="color:rgb(98,98,98)">&gt;</span> threshold)
<span class="ansi-green-fg ansi-bold">      3</span> <span style="color:rgb(0,135,0)">print</span>(y_some_digit_pred)

<span class="ansi-red-fg">NameError</span>: name 'y_scores' is not defined</pre>
</div>
</div>
</div>
<pre><code>[False]</code></pre>
<div id="8330afb0" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>y_scores <span class="op">=</span> cross_val_predict(sgd_clf, X_train, y_train_5, cv<span class="op">=</span><span class="dv">3</span>,</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>                             method<span class="op">=</span><span class="st">"decision_function"</span>)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="co"># hack to work around issue #9589 in Scikit-Learn 0.19.0</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> y_scores.ndim <span class="op">==</span> <span class="dv">2</span>:</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    y_scores <span class="op">=</span> y_scores[:, <span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">InvalidParameterError</span>                     Traceback (most recent call last)
Cell <span class="ansi-green-fg">In[19], line 1</span>
<span class="ansi-green-fg">----&gt; 1</span> y_scores <span style="color:rgb(98,98,98)">=</span> cross_val_predict(sgd_clf, X_train, y_train_5, cv<span style="color:rgb(98,98,98)">=</span><span style="color:rgb(98,98,98)">3</span>,
<span class="ansi-green-fg ansi-bold">      2</span>                              method<span style="color:rgb(98,98,98)">=</span><span style="color:rgb(175,0,0)">"</span><span style="color:rgb(175,0,0)">decision_function</span><span style="color:rgb(175,0,0)">"</span>)
<span class="ansi-green-fg ansi-bold">      4</span> <span style="font-style:italic;color:rgb(95,135,135)"># hack to work around issue #9589 in Scikit-Learn 0.19.0</span>
<span class="ansi-green-fg ansi-bold">      5</span> <span style="font-weight:bold;color:rgb(0,135,0)">if</span> y_scores<span style="color:rgb(98,98,98)">.</span>ndim <span style="color:rgb(98,98,98)">==</span> <span style="color:rgb(98,98,98)">2</span>:

File <span class="ansi-green-fg">~/anaconda3/envs/islp/lib/python3.11/site-packages/sklearn/model_selection/_validation.py:986</span>, in <span class="ansi-cyan-fg">cross_val_predict</span><span class="ansi-blue-fg">(estimator, X, y, groups, cv, n_jobs, verbose, fit_params, pre_dispatch, method)</span>
<span class="ansi-green-fg ansi-bold">    983</span> <span style="font-style:italic;color:rgb(95,135,135)"># We clone the estimator to make sure that all the folds are</span>
<span class="ansi-green-fg ansi-bold">    984</span> <span style="font-style:italic;color:rgb(95,135,135)"># independent, and that it is pickle-able.</span>
<span class="ansi-green-fg ansi-bold">    985</span> parallel <span style="color:rgb(98,98,98)">=</span> Parallel(n_jobs<span style="color:rgb(98,98,98)">=</span>n_jobs, verbose<span style="color:rgb(98,98,98)">=</span>verbose, pre_dispatch<span style="color:rgb(98,98,98)">=</span>pre_dispatch)
<span class="ansi-green-fg">--&gt; 986</span> predictions <span style="color:rgb(98,98,98)">=</span> parallel(
<span class="ansi-green-fg ansi-bold">    987</span>     delayed(_fit_and_predict)(
<span class="ansi-green-fg ansi-bold">    988</span>         clone(estimator), X, y, train, test, verbose, fit_params, method
<span class="ansi-green-fg ansi-bold">    989</span>     )
<span class="ansi-green-fg ansi-bold">    990</span>     <span style="font-weight:bold;color:rgb(0,135,0)">for</span> train, test <span style="font-weight:bold;color:rgb(175,0,255)">in</span> splits
<span class="ansi-green-fg ansi-bold">    991</span> )
<span class="ansi-green-fg ansi-bold">    993</span> inv_test_indices <span style="color:rgb(98,98,98)">=</span> np<span style="color:rgb(98,98,98)">.</span>empty(<span style="color:rgb(0,135,0)">len</span>(test_indices), dtype<span style="color:rgb(98,98,98)">=</span><span style="color:rgb(0,135,0)">int</span>)
<span class="ansi-green-fg ansi-bold">    994</span> inv_test_indices[test_indices] <span style="color:rgb(98,98,98)">=</span> np<span style="color:rgb(98,98,98)">.</span>arange(<span style="color:rgb(0,135,0)">len</span>(test_indices))

File <span class="ansi-green-fg">~/anaconda3/envs/islp/lib/python3.11/site-packages/sklearn/utils/parallel.py:63</span>, in <span class="ansi-cyan-fg">Parallel.__call__</span><span class="ansi-blue-fg">(self, iterable)</span>
<span class="ansi-green-fg ansi-bold">     58</span> config <span style="color:rgb(98,98,98)">=</span> get_config()
<span class="ansi-green-fg ansi-bold">     59</span> iterable_with_config <span style="color:rgb(98,98,98)">=</span> (
<span class="ansi-green-fg ansi-bold">     60</span>     (_with_config(delayed_func, config), args, kwargs)
<span class="ansi-green-fg ansi-bold">     61</span>     <span style="font-weight:bold;color:rgb(0,135,0)">for</span> delayed_func, args, kwargs <span style="font-weight:bold;color:rgb(175,0,255)">in</span> iterable
<span class="ansi-green-fg ansi-bold">     62</span> )
<span class="ansi-green-fg">---&gt; 63</span> <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span style="color:rgb(0,135,0)">super</span>()<span style="color:rgb(98,98,98)">.</span><span style="color:rgb(0,0,255)">__call__</span>(iterable_with_config)

File <span class="ansi-green-fg">~/anaconda3/envs/islp/lib/python3.11/site-packages/joblib/parallel.py:1085</span>, in <span class="ansi-cyan-fg">Parallel.__call__</span><span class="ansi-blue-fg">(self, iterable)</span>
<span class="ansi-green-fg ansi-bold">   1076</span> <span style="font-weight:bold;color:rgb(0,135,0)">try</span>:
<span class="ansi-green-fg ansi-bold">   1077</span>     <span style="font-style:italic;color:rgb(95,135,135)"># Only set self._iterating to True if at least a batch</span>
<span class="ansi-green-fg ansi-bold">   1078</span>     <span style="font-style:italic;color:rgb(95,135,135)"># was dispatched. In particular this covers the edge</span>
<span class="ansi-green-fg">   (...)</span>
<span class="ansi-green-fg ansi-bold">   1082</span>     <span style="font-style:italic;color:rgb(95,135,135)"># was very quick and its callback already dispatched all the</span>
<span class="ansi-green-fg ansi-bold">   1083</span>     <span style="font-style:italic;color:rgb(95,135,135)"># remaining jobs.</span>
<span class="ansi-green-fg ansi-bold">   1084</span>     <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>_iterating <span style="color:rgb(98,98,98)">=</span> <span style="font-weight:bold;color:rgb(0,135,0)">False</span>
<span class="ansi-green-fg">-&gt; 1085</span>     <span style="font-weight:bold;color:rgb(0,135,0)">if</span> <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>dispatch_one_batch(iterator):
<span class="ansi-green-fg ansi-bold">   1086</span>         <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>_iterating <span style="color:rgb(98,98,98)">=</span> <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>_original_iterator <span style="font-weight:bold;color:rgb(175,0,255)">is</span> <span style="font-weight:bold;color:rgb(175,0,255)">not</span> <span style="font-weight:bold;color:rgb(0,135,0)">None</span>
<span class="ansi-green-fg ansi-bold">   1088</span>     <span style="font-weight:bold;color:rgb(0,135,0)">while</span> <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>dispatch_one_batch(iterator):

File <span class="ansi-green-fg">~/anaconda3/envs/islp/lib/python3.11/site-packages/joblib/parallel.py:901</span>, in <span class="ansi-cyan-fg">Parallel.dispatch_one_batch</span><span class="ansi-blue-fg">(self, iterator)</span>
<span class="ansi-green-fg ansi-bold">    899</span>     <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span style="font-weight:bold;color:rgb(0,135,0)">False</span>
<span class="ansi-green-fg ansi-bold">    900</span> <span style="font-weight:bold;color:rgb(0,135,0)">else</span>:
<span class="ansi-green-fg">--&gt; 901</span>     <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>_dispatch(tasks)
<span class="ansi-green-fg ansi-bold">    902</span>     <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span style="font-weight:bold;color:rgb(0,135,0)">True</span>

File <span class="ansi-green-fg">~/anaconda3/envs/islp/lib/python3.11/site-packages/joblib/parallel.py:819</span>, in <span class="ansi-cyan-fg">Parallel._dispatch</span><span class="ansi-blue-fg">(self, batch)</span>
<span class="ansi-green-fg ansi-bold">    817</span> <span style="font-weight:bold;color:rgb(0,135,0)">with</span> <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>_lock:
<span class="ansi-green-fg ansi-bold">    818</span>     job_idx <span style="color:rgb(98,98,98)">=</span> <span style="color:rgb(0,135,0)">len</span>(<span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>_jobs)
<span class="ansi-green-fg">--&gt; 819</span>     job <span style="color:rgb(98,98,98)">=</span> <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>_backend<span style="color:rgb(98,98,98)">.</span>apply_async(batch, callback<span style="color:rgb(98,98,98)">=</span>cb)
<span class="ansi-green-fg ansi-bold">    820</span>     <span style="font-style:italic;color:rgb(95,135,135)"># A job can complete so quickly than its callback is</span>
<span class="ansi-green-fg ansi-bold">    821</span>     <span style="font-style:italic;color:rgb(95,135,135)"># called before we get here, causing self._jobs to</span>
<span class="ansi-green-fg ansi-bold">    822</span>     <span style="font-style:italic;color:rgb(95,135,135)"># grow. To ensure correct results ordering, .insert is</span>
<span class="ansi-green-fg ansi-bold">    823</span>     <span style="font-style:italic;color:rgb(95,135,135)"># used (rather than .append) in the following line</span>
<span class="ansi-green-fg ansi-bold">    824</span>     <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>_jobs<span style="color:rgb(98,98,98)">.</span>insert(job_idx, job)

File <span class="ansi-green-fg">~/anaconda3/envs/islp/lib/python3.11/site-packages/joblib/_parallel_backends.py:208</span>, in <span class="ansi-cyan-fg">SequentialBackend.apply_async</span><span class="ansi-blue-fg">(self, func, callback)</span>
<span class="ansi-green-fg ansi-bold">    206</span> <span style="font-weight:bold;color:rgb(0,135,0)">def</span> <span style="color:rgb(0,0,255)">apply_async</span>(<span style="color:rgb(0,135,0)">self</span>, func, callback<span style="color:rgb(98,98,98)">=</span><span style="font-weight:bold;color:rgb(0,135,0)">None</span>):
<span class="ansi-green-fg ansi-bold">    207</span> <span style="color:rgb(188,188,188)">    </span><span style="font-style:italic;color:rgb(175,0,0)">"""Schedule a func to be run"""</span>
<span class="ansi-green-fg">--&gt; 208</span>     result <span style="color:rgb(98,98,98)">=</span> ImmediateResult(func)
<span class="ansi-green-fg ansi-bold">    209</span>     <span style="font-weight:bold;color:rgb(0,135,0)">if</span> callback:
<span class="ansi-green-fg ansi-bold">    210</span>         callback(result)

File <span class="ansi-green-fg">~/anaconda3/envs/islp/lib/python3.11/site-packages/joblib/_parallel_backends.py:597</span>, in <span class="ansi-cyan-fg">ImmediateResult.__init__</span><span class="ansi-blue-fg">(self, batch)</span>
<span class="ansi-green-fg ansi-bold">    594</span> <span style="font-weight:bold;color:rgb(0,135,0)">def</span> <span style="color:rgb(0,0,255)">__init__</span>(<span style="color:rgb(0,135,0)">self</span>, batch):
<span class="ansi-green-fg ansi-bold">    595</span>     <span style="font-style:italic;color:rgb(95,135,135)"># Don't delay the application, to avoid keeping the input</span>
<span class="ansi-green-fg ansi-bold">    596</span>     <span style="font-style:italic;color:rgb(95,135,135)"># arguments in memory</span>
<span class="ansi-green-fg">--&gt; 597</span>     <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>results <span style="color:rgb(98,98,98)">=</span> batch()

File <span class="ansi-green-fg">~/anaconda3/envs/islp/lib/python3.11/site-packages/joblib/parallel.py:288</span>, in <span class="ansi-cyan-fg">BatchedCalls.__call__</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-fg ansi-bold">    284</span> <span style="font-weight:bold;color:rgb(0,135,0)">def</span> <span style="color:rgb(0,0,255)">__call__</span>(<span style="color:rgb(0,135,0)">self</span>):
<span class="ansi-green-fg ansi-bold">    285</span>     <span style="font-style:italic;color:rgb(95,135,135)"># Set the default nested backend to self._backend but do not set the</span>
<span class="ansi-green-fg ansi-bold">    286</span>     <span style="font-style:italic;color:rgb(95,135,135)"># change the default number of processes to -1</span>
<span class="ansi-green-fg ansi-bold">    287</span>     <span style="font-weight:bold;color:rgb(0,135,0)">with</span> parallel_backend(<span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>_backend, n_jobs<span style="color:rgb(98,98,98)">=</span><span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>_n_jobs):
<span class="ansi-green-fg">--&gt; 288</span>         <span style="font-weight:bold;color:rgb(0,135,0)">return</span> [func(<span style="color:rgb(98,98,98)">*</span>args, <span style="color:rgb(98,98,98)">*</span><span style="color:rgb(98,98,98)">*</span>kwargs)
<span class="ansi-green-fg ansi-bold">    289</span>                 <span style="font-weight:bold;color:rgb(0,135,0)">for</span> func, args, kwargs <span style="font-weight:bold;color:rgb(175,0,255)">in</span> <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>items]

File <span class="ansi-green-fg">~/anaconda3/envs/islp/lib/python3.11/site-packages/joblib/parallel.py:288</span>, in <span class="ansi-cyan-fg">&lt;listcomp&gt;</span><span class="ansi-blue-fg">(.0)</span>
<span class="ansi-green-fg ansi-bold">    284</span> <span style="font-weight:bold;color:rgb(0,135,0)">def</span> <span style="color:rgb(0,0,255)">__call__</span>(<span style="color:rgb(0,135,0)">self</span>):
<span class="ansi-green-fg ansi-bold">    285</span>     <span style="font-style:italic;color:rgb(95,135,135)"># Set the default nested backend to self._backend but do not set the</span>
<span class="ansi-green-fg ansi-bold">    286</span>     <span style="font-style:italic;color:rgb(95,135,135)"># change the default number of processes to -1</span>
<span class="ansi-green-fg ansi-bold">    287</span>     <span style="font-weight:bold;color:rgb(0,135,0)">with</span> parallel_backend(<span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>_backend, n_jobs<span style="color:rgb(98,98,98)">=</span><span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>_n_jobs):
<span class="ansi-green-fg">--&gt; 288</span>         <span style="font-weight:bold;color:rgb(0,135,0)">return</span> [func(<span style="color:rgb(98,98,98)">*</span>args, <span style="color:rgb(98,98,98)">*</span><span style="color:rgb(98,98,98)">*</span>kwargs)
<span class="ansi-green-fg ansi-bold">    289</span>                 <span style="font-weight:bold;color:rgb(0,135,0)">for</span> func, args, kwargs <span style="font-weight:bold;color:rgb(175,0,255)">in</span> <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>items]

File <span class="ansi-green-fg">~/anaconda3/envs/islp/lib/python3.11/site-packages/sklearn/utils/parallel.py:123</span>, in <span class="ansi-cyan-fg">_FuncWrapper.__call__</span><span class="ansi-blue-fg">(self, *args, **kwargs)</span>
<span class="ansi-green-fg ansi-bold">    121</span>     config <span style="color:rgb(98,98,98)">=</span> {}
<span class="ansi-green-fg ansi-bold">    122</span> <span style="font-weight:bold;color:rgb(0,135,0)">with</span> config_context(<span style="color:rgb(98,98,98)">*</span><span style="color:rgb(98,98,98)">*</span>config):
<span class="ansi-green-fg">--&gt; 123</span>     <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>function(<span style="color:rgb(98,98,98)">*</span>args, <span style="color:rgb(98,98,98)">*</span><span style="color:rgb(98,98,98)">*</span>kwargs)

File <span class="ansi-green-fg">~/anaconda3/envs/islp/lib/python3.11/site-packages/sklearn/model_selection/_validation.py:1068</span>, in <span class="ansi-cyan-fg">_fit_and_predict</span><span class="ansi-blue-fg">(estimator, X, y, train, test, verbose, fit_params, method)</span>
<span class="ansi-green-fg ansi-bold">   1066</span>     estimator<span style="color:rgb(98,98,98)">.</span>fit(X_train, <span style="color:rgb(98,98,98)">*</span><span style="color:rgb(98,98,98)">*</span>fit_params)
<span class="ansi-green-fg ansi-bold">   1067</span> <span style="font-weight:bold;color:rgb(0,135,0)">else</span>:
<span class="ansi-green-fg">-&gt; 1068</span>     estimator<span style="color:rgb(98,98,98)">.</span>fit(X_train, y_train, <span style="color:rgb(98,98,98)">*</span><span style="color:rgb(98,98,98)">*</span>fit_params)
<span class="ansi-green-fg ansi-bold">   1069</span> func <span style="color:rgb(98,98,98)">=</span> <span style="color:rgb(0,135,0)">getattr</span>(estimator, method)
<span class="ansi-green-fg ansi-bold">   1070</span> predictions <span style="color:rgb(98,98,98)">=</span> func(X_test)

File <span class="ansi-green-fg">~/anaconda3/envs/islp/lib/python3.11/site-packages/sklearn/linear_model/_stochastic_gradient.py:891</span>, in <span class="ansi-cyan-fg">BaseSGDClassifier.fit</span><span class="ansi-blue-fg">(self, X, y, coef_init, intercept_init, sample_weight)</span>
<span class="ansi-green-fg ansi-bold">    863</span> <span style="font-weight:bold;color:rgb(0,135,0)">def</span> <span style="color:rgb(0,0,255)">fit</span>(<span style="color:rgb(0,135,0)">self</span>, X, y, coef_init<span style="color:rgb(98,98,98)">=</span><span style="font-weight:bold;color:rgb(0,135,0)">None</span>, intercept_init<span style="color:rgb(98,98,98)">=</span><span style="font-weight:bold;color:rgb(0,135,0)">None</span>, sample_weight<span style="color:rgb(98,98,98)">=</span><span style="font-weight:bold;color:rgb(0,135,0)">None</span>):
<span class="ansi-green-fg ansi-bold">    864</span> <span style="color:rgb(188,188,188)">    </span><span style="font-style:italic;color:rgb(175,0,0)">"""Fit linear model with Stochastic Gradient Descent.</span>
<span class="ansi-green-fg ansi-bold">    865</span> 
<span class="ansi-green-fg ansi-bold">    866</span> <span style="font-style:italic;color:rgb(175,0,0)">    Parameters</span>
<span class="ansi-green-fg">   (...)</span>
<span class="ansi-green-fg ansi-bold">    889</span> <span style="font-style:italic;color:rgb(175,0,0)">        Returns an instance of self.</span>
<span class="ansi-green-fg ansi-bold">    890</span> <span style="font-style:italic;color:rgb(175,0,0)">    """</span>
<span class="ansi-green-fg">--&gt; 891</span>     <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>_validate_params()
<span class="ansi-green-fg ansi-bold">    892</span>     <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>_more_validate_params()
<span class="ansi-green-fg ansi-bold">    894</span>     <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>_fit(
<span class="ansi-green-fg ansi-bold">    895</span>         X,
<span class="ansi-green-fg ansi-bold">    896</span>         y,
<span class="ansi-green-fg">   (...)</span>
<span class="ansi-green-fg ansi-bold">    903</span>         sample_weight<span style="color:rgb(98,98,98)">=</span>sample_weight,
<span class="ansi-green-fg ansi-bold">    904</span>     )

File <span class="ansi-green-fg">~/anaconda3/envs/islp/lib/python3.11/site-packages/sklearn/base.py:600</span>, in <span class="ansi-cyan-fg">BaseEstimator._validate_params</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-fg ansi-bold">    592</span> <span style="font-weight:bold;color:rgb(0,135,0)">def</span> <span style="color:rgb(0,0,255)">_validate_params</span>(<span style="color:rgb(0,135,0)">self</span>):
<span class="ansi-green-fg ansi-bold">    593</span> <span style="color:rgb(188,188,188)">    </span><span style="font-style:italic;color:rgb(175,0,0)">"""Validate types and values of constructor parameters</span>
<span class="ansi-green-fg ansi-bold">    594</span> 
<span class="ansi-green-fg ansi-bold">    595</span> <span style="font-style:italic;color:rgb(175,0,0)">    The expected type and values must be defined in the `_parameter_constraints`</span>
<span class="ansi-green-fg">   (...)</span>
<span class="ansi-green-fg ansi-bold">    598</span> <span style="font-style:italic;color:rgb(175,0,0)">    accepted constraints.</span>
<span class="ansi-green-fg ansi-bold">    599</span> <span style="font-style:italic;color:rgb(175,0,0)">    """</span>
<span class="ansi-green-fg">--&gt; 600</span>     validate_parameter_constraints(
<span class="ansi-green-fg ansi-bold">    601</span>         <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>_parameter_constraints,
<span class="ansi-green-fg ansi-bold">    602</span>         <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>get_params(deep<span style="color:rgb(98,98,98)">=</span><span style="font-weight:bold;color:rgb(0,135,0)">False</span>),
<span class="ansi-green-fg ansi-bold">    603</span>         caller_name<span style="color:rgb(98,98,98)">=</span><span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span><span style="color:rgb(0,0,135)">__class__</span><span style="color:rgb(98,98,98)">.</span><span style="color:rgb(0,0,135)">__name__</span>,
<span class="ansi-green-fg ansi-bold">    604</span>     )

File <span class="ansi-green-fg">~/anaconda3/envs/islp/lib/python3.11/site-packages/sklearn/utils/_param_validation.py:97</span>, in <span class="ansi-cyan-fg">validate_parameter_constraints</span><span class="ansi-blue-fg">(parameter_constraints, params, caller_name)</span>
<span class="ansi-green-fg ansi-bold">     91</span> <span style="font-weight:bold;color:rgb(0,135,0)">else</span>:
<span class="ansi-green-fg ansi-bold">     92</span>     constraints_str <span style="color:rgb(98,98,98)">=</span> (
<span class="ansi-green-fg ansi-bold">     93</span>         <span style="color:rgb(175,0,0)">f</span><span style="color:rgb(175,0,0)">"</span><span style="font-weight:bold;color:rgb(175,95,135)">{</span><span style="color:rgb(175,0,0)">'</span><span style="color:rgb(175,0,0)">, </span><span style="color:rgb(175,0,0)">'</span><span style="color:rgb(98,98,98)">.</span>join([<span style="color:rgb(0,135,0)">str</span>(c)<span style="color:rgb(188,188,188)"> </span><span style="font-weight:bold;color:rgb(0,135,0)">for</span><span style="color:rgb(188,188,188)"> </span>c<span style="color:rgb(188,188,188)"> </span><span style="font-weight:bold;color:rgb(175,0,255)">in</span><span style="color:rgb(188,188,188)"> </span>constraints[:<span style="color:rgb(98,98,98)">-</span><span style="color:rgb(98,98,98)">1</span>]])<span style="font-weight:bold;color:rgb(175,95,135)">}</span><span style="color:rgb(175,0,0)"> or</span><span style="color:rgb(175,0,0)">"</span>
<span class="ansi-green-fg ansi-bold">     94</span>         <span style="color:rgb(175,0,0)">f</span><span style="color:rgb(175,0,0)">"</span><span style="color:rgb(175,0,0)"> </span><span style="font-weight:bold;color:rgb(175,95,135)">{</span>constraints[<span style="color:rgb(98,98,98)">-</span><span style="color:rgb(98,98,98)">1</span>]<span style="font-weight:bold;color:rgb(175,95,135)">}</span><span style="color:rgb(175,0,0)">"</span>
<span class="ansi-green-fg ansi-bold">     95</span>     )
<span class="ansi-green-fg">---&gt; 97</span> <span style="font-weight:bold;color:rgb(0,135,0)">raise</span> InvalidParameterError(
<span class="ansi-green-fg ansi-bold">     98</span>     <span style="color:rgb(175,0,0)">f</span><span style="color:rgb(175,0,0)">"</span><span style="color:rgb(175,0,0)">The </span><span style="font-weight:bold;color:rgb(175,95,135)">{</span>param_name<span style="font-weight:bold;color:rgb(175,95,135)">!r}</span><span style="color:rgb(175,0,0)"> parameter of </span><span style="font-weight:bold;color:rgb(175,95,135)">{</span>caller_name<span style="font-weight:bold;color:rgb(175,95,135)">}</span><span style="color:rgb(175,0,0)"> must be</span><span style="color:rgb(175,0,0)">"</span>
<span class="ansi-green-fg ansi-bold">     99</span>     <span style="color:rgb(175,0,0)">f</span><span style="color:rgb(175,0,0)">"</span><span style="color:rgb(175,0,0)"> </span><span style="font-weight:bold;color:rgb(175,95,135)">{</span>constraints_str<span style="font-weight:bold;color:rgb(175,95,135)">}</span><span style="color:rgb(175,0,0)">. Got </span><span style="font-weight:bold;color:rgb(175,95,135)">{</span>param_val<span style="font-weight:bold;color:rgb(175,95,135)">!r}</span><span style="color:rgb(175,0,0)"> instead.</span><span style="color:rgb(175,0,0)">"</span>
<span class="ansi-green-fg ansi-bold">    100</span> )

<span class="ansi-red-fg">InvalidParameterError</span>: The 'tol' parameter of SGDClassifier must be a float in the range [0, inf) or None. Got -inf instead.</pre>
</div>
</div>
</div>
<p>With these scores we can now use the <code>precision_recall_curve()</code> function from the <code>sklearn.metrics</code> library.</p>
<div id="ea043e39" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> precision_recall_curve</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>precisions, recalls, thresholds <span class="op">=</span> precision_recall_curve(y_train_5, y_scores)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_precision_recall_vs_threshold(precisions, recalls, thresholds):</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>    plt.plot(thresholds, precisions[:<span class="op">-</span><span class="dv">1</span>], <span class="st">"b--"</span>, label<span class="op">=</span><span class="st">"Precision"</span>, linewidth<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>    plt.plot(thresholds, recalls[:<span class="op">-</span><span class="dv">1</span>], <span class="st">"g-"</span>, label<span class="op">=</span><span class="st">"Recall"</span>, linewidth<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">"Threshold"</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>    plt.legend(loc<span class="op">=</span><span class="st">"upper left"</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>    plt.ylim([<span class="dv">0</span>, <span class="dv">1</span>])</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">4</span>))</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>plot_precision_recall_vs_threshold(precisions, recalls, thresholds)</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>plt.xlim([<span class="op">-</span><span class="dv">700000</span>, <span class="dv">700000</span>])</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a><span class="co"># save_fig("precision_recall_vs_threshold_plot")</span></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
Cell <span class="ansi-green-fg">In[20], line 2</span>
<span class="ansi-green-fg ansi-bold">      1</span> <span style="font-weight:bold;color:rgb(0,135,0)">from</span> <span style="font-weight:bold;color:rgb(0,0,255)">sklearn</span><span style="font-weight:bold;color:rgb(0,0,255)">.</span><span style="font-weight:bold;color:rgb(0,0,255)">metrics</span> <span style="font-weight:bold;color:rgb(0,135,0)">import</span> precision_recall_curve
<span class="ansi-green-fg">----&gt; 2</span> precisions, recalls, thresholds <span style="color:rgb(98,98,98)">=</span> precision_recall_curve(y_train_5, y_scores)
<span class="ansi-green-fg ansi-bold">      4</span> <span style="font-weight:bold;color:rgb(0,135,0)">def</span> <span style="color:rgb(0,0,255)">plot_precision_recall_vs_threshold</span>(precisions, recalls, thresholds):
<span class="ansi-green-fg ansi-bold">      5</span>     plt<span style="color:rgb(98,98,98)">.</span>plot(thresholds, precisions[:<span style="color:rgb(98,98,98)">-</span><span style="color:rgb(98,98,98)">1</span>], <span style="color:rgb(175,0,0)">"</span><span style="color:rgb(175,0,0)">b--</span><span style="color:rgb(175,0,0)">"</span>, label<span style="color:rgb(98,98,98)">=</span><span style="color:rgb(175,0,0)">"</span><span style="color:rgb(175,0,0)">Precision</span><span style="color:rgb(175,0,0)">"</span>, linewidth<span style="color:rgb(98,98,98)">=</span><span style="color:rgb(98,98,98)">2</span>)

<span class="ansi-red-fg">NameError</span>: name 'y_scores' is not defined</pre>
</div>
</div>
</div>
<div id="e8ede3c6" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>(y_train_pred <span class="op">==</span> (y_scores <span class="op">&gt;</span> <span class="dv">0</span>)).<span class="bu">all</span>()</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>y_train_pred_90 <span class="op">=</span> (y_scores <span class="op">&gt;</span> <span class="dv">70000</span>)</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(precision_score(y_train_5, y_train_pred_90))</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(recall_score(y_train_5, y_train_pred_90))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
Cell <span class="ansi-green-fg">In[21], line 1</span>
<span class="ansi-green-fg">----&gt; 1</span> (y_train_pred <span style="color:rgb(98,98,98)">==</span> (y_scores <span style="color:rgb(98,98,98)">&gt;</span> <span style="color:rgb(98,98,98)">0</span>))<span style="color:rgb(98,98,98)">.</span>all()
<span class="ansi-green-fg ansi-bold">      3</span> y_train_pred_90 <span style="color:rgb(98,98,98)">=</span> (y_scores <span style="color:rgb(98,98,98)">&gt;</span> <span style="color:rgb(98,98,98)">70000</span>)
<span class="ansi-green-fg ansi-bold">      5</span> <span style="color:rgb(0,135,0)">print</span>(precision_score(y_train_5, y_train_pred_90))

<span class="ansi-red-fg">NameError</span>: name 'y_train_pred' is not defined</pre>
</div>
</div>
</div>
<div id="b81074f5" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_precision_vs_recall(precisions, recalls):</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>    plt.plot(recalls, precisions, <span class="st">"b-"</span>, linewidth<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">"Recall"</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">"Precision"</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>    plt.axis([<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>])</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>plot_precision_vs_recall(precisions, recalls)</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a><span class="co"># save_fig("precision_vs_recall_plot")</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
Cell <span class="ansi-green-fg">In[22], line 8</span>
<span class="ansi-green-fg ansi-bold">      5</span>     plt<span style="color:rgb(98,98,98)">.</span>axis([<span style="color:rgb(98,98,98)">0</span>, <span style="color:rgb(98,98,98)">1</span>, <span style="color:rgb(98,98,98)">0</span>, <span style="color:rgb(98,98,98)">1</span>])
<span class="ansi-green-fg ansi-bold">      7</span> plt<span style="color:rgb(98,98,98)">.</span>figure(figsize<span style="color:rgb(98,98,98)">=</span>(<span style="color:rgb(98,98,98)">8</span>, <span style="color:rgb(98,98,98)">6</span>))
<span class="ansi-green-fg">----&gt; 8</span> plot_precision_vs_recall(precisions, recalls)
<span class="ansi-green-fg ansi-bold">      9</span> <span style="font-style:italic;color:rgb(95,135,135)"># save_fig("precision_vs_recall_plot")</span>
<span class="ansi-green-fg ansi-bold">     10</span> plt<span style="color:rgb(98,98,98)">.</span>show()

<span class="ansi-red-fg">NameError</span>: name 'precisions' is not defined</pre>
</div>
</div>
<div class="cell-output cell-output-display">
<pre><code>&lt;Figure size 768x576 with 0 Axes&gt;</code></pre>
</div>
</div>
</section>
<section id="roc-curves" class="level3" data-number="17.1.5">
<h3 data-number="17.1.5" class="anchored" data-anchor-id="roc-curves"><span class="header-section-number">17.1.5</span> ROC curves</h3>
<div id="a1ab0656" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> roc_curve</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>fpr, tpr, thresholds <span class="op">=</span> roc_curve(y_train_5, y_scores)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_roc_curve(fpr, tpr, label<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>    plt.plot(fpr, tpr, linewidth<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span>label)</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>    plt.plot([<span class="dv">0</span>, <span class="dv">1</span>], [<span class="dv">0</span>, <span class="dv">1</span>], <span class="st">'k--'</span>)</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>    plt.axis([<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>])</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">'False Positive Rate'</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">'True Positive Rate'</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>plot_roc_curve(fpr, tpr)</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a><span class="co"># save_fig("roc_curve_plot")</span></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
Cell <span class="ansi-green-fg">In[23], line 2</span>
<span class="ansi-green-fg ansi-bold">      1</span> <span style="font-weight:bold;color:rgb(0,135,0)">from</span> <span style="font-weight:bold;color:rgb(0,0,255)">sklearn</span><span style="font-weight:bold;color:rgb(0,0,255)">.</span><span style="font-weight:bold;color:rgb(0,0,255)">metrics</span> <span style="font-weight:bold;color:rgb(0,135,0)">import</span> roc_curve
<span class="ansi-green-fg">----&gt; 2</span> fpr, tpr, thresholds <span style="color:rgb(98,98,98)">=</span> roc_curve(y_train_5, y_scores)
<span class="ansi-green-fg ansi-bold">      4</span> <span style="font-weight:bold;color:rgb(0,135,0)">def</span> <span style="color:rgb(0,0,255)">plot_roc_curve</span>(fpr, tpr, label<span style="color:rgb(98,98,98)">=</span><span style="font-weight:bold;color:rgb(0,135,0)">None</span>):
<span class="ansi-green-fg ansi-bold">      5</span>     plt<span style="color:rgb(98,98,98)">.</span>plot(fpr, tpr, linewidth<span style="color:rgb(98,98,98)">=</span><span style="color:rgb(98,98,98)">2</span>, label<span style="color:rgb(98,98,98)">=</span>label)

<span class="ansi-red-fg">NameError</span>: name 'y_scores' is not defined</pre>
</div>
</div>
</div>
<div id="bdc719d7" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> roc_auc_score</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(roc_auc_score(y_train_5, y_scores))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
Cell <span class="ansi-green-fg">In[24], line 2</span>
<span class="ansi-green-fg ansi-bold">      1</span> <span style="font-weight:bold;color:rgb(0,135,0)">from</span> <span style="font-weight:bold;color:rgb(0,0,255)">sklearn</span><span style="font-weight:bold;color:rgb(0,0,255)">.</span><span style="font-weight:bold;color:rgb(0,0,255)">metrics</span> <span style="font-weight:bold;color:rgb(0,135,0)">import</span> roc_auc_score
<span class="ansi-green-fg">----&gt; 2</span> <span style="color:rgb(0,135,0)">print</span>(roc_auc_score(y_train_5, y_scores))

<span class="ansi-red-fg">NameError</span>: name 'y_scores' is not defined</pre>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>We set n_estimators=10 to avoid a warning about the fact that its default value will be set to 100 in Scikit-Learn 0.22.</p>
</div>
</div>
<div id="7d05a79a" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestClassifier</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>forest_clf <span class="op">=</span> RandomForestClassifier(n_estimators<span class="op">=</span><span class="dv">10</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>y_probas_forest <span class="op">=</span> cross_val_predict(forest_clf, X_train, y_train_5, cv<span class="op">=</span><span class="dv">3</span>,</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>                                    method<span class="op">=</span><span class="st">"predict_proba"</span>)</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>y_scores_forest <span class="op">=</span> y_probas_forest[:, <span class="dv">1</span>] <span class="co"># score = proba of positive class</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>fpr_forest, tpr_forest, thresholds_forest <span class="op">=</span> roc_curve(y_train_5,y_scores_forest)</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>plt.plot(fpr, tpr, <span class="st">"b:"</span>, linewidth<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="st">"SGD"</span>)</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>plot_roc_curve(fpr_forest, tpr_forest, <span class="st">"Random Forest"</span>)</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>plt.legend(loc<span class="op">=</span><span class="st">"lower right"</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a><span class="co"># save_fig("roc_curve_comparison_plot")</span></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
Cell <span class="ansi-green-fg">In[25], line 10</span>
<span class="ansi-green-fg ansi-bold">      7</span> fpr_forest, tpr_forest, thresholds_forest <span style="color:rgb(98,98,98)">=</span> roc_curve(y_train_5,y_scores_forest)
<span class="ansi-green-fg ansi-bold">      9</span> plt<span style="color:rgb(98,98,98)">.</span>figure(figsize<span style="color:rgb(98,98,98)">=</span>(<span style="color:rgb(98,98,98)">8</span>, <span style="color:rgb(98,98,98)">6</span>))
<span class="ansi-green-fg">---&gt; 10</span> plt<span style="color:rgb(98,98,98)">.</span>plot(fpr, tpr, <span style="color:rgb(175,0,0)">"</span><span style="color:rgb(175,0,0)">b:</span><span style="color:rgb(175,0,0)">"</span>, linewidth<span style="color:rgb(98,98,98)">=</span><span style="color:rgb(98,98,98)">2</span>, label<span style="color:rgb(98,98,98)">=</span><span style="color:rgb(175,0,0)">"</span><span style="color:rgb(175,0,0)">SGD</span><span style="color:rgb(175,0,0)">"</span>)
<span class="ansi-green-fg ansi-bold">     11</span> plot_roc_curve(fpr_forest, tpr_forest, <span style="color:rgb(175,0,0)">"</span><span style="color:rgb(175,0,0)">Random Forest</span><span style="color:rgb(175,0,0)">"</span>)
<span class="ansi-green-fg ansi-bold">     12</span> plt<span style="color:rgb(98,98,98)">.</span>legend(loc<span style="color:rgb(98,98,98)">=</span><span style="color:rgb(175,0,0)">"</span><span style="color:rgb(175,0,0)">lower right</span><span style="color:rgb(175,0,0)">"</span>, fontsize<span style="color:rgb(98,98,98)">=</span><span style="color:rgb(98,98,98)">16</span>)

<span class="ansi-red-fg">NameError</span>: name 'fpr' is not defined</pre>
</div>
</div>
<div class="cell-output cell-output-display">
<pre><code>&lt;Figure size 768x576 with 0 Axes&gt;</code></pre>
</div>
</div>
<div id="726581d0" class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(roc_auc_score(y_train_5, y_scores_forest))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0.9930697252868758</code></pre>
</div>
</div>
<div id="81ae8e7a" class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>y_train_pred_forest <span class="op">=</span> cross_val_predict(forest_clf, X_train, y_train_5, cv<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>precision_score(y_train_5, y_train_pred_forest)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(recall_score(y_train_5, y_train_pred_forest))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0.8269691938756687</code></pre>
</div>
</div>
</section>
</section>
<section id="key-concepts-and-summary" class="level2" data-number="17.2">
<h2 data-number="17.2" class="anchored" data-anchor-id="key-concepts-and-summary"><span class="header-section-number">17.2</span> Key Concepts and Summary</h2>
<p>Machine learning</p>
<ul>
<li>The basic</li>
<li>Some central</li>
</ul>
</section>
<section id="self-check-questions" class="level2" data-number="17.3">
<h2 data-number="17.3" class="anchored" data-anchor-id="self-check-questions"><span class="header-section-number">17.3</span> Self-Check Questions</h2>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
ToDo
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Why is regression analysis machine learning. What type of machine learning is it?</li>
</ul>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./ml_2_OLS.html" class="pagination-link" aria-label="Machine Learning: A First Example with OLS">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Machine Learning: A First Example with OLS</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./ml_4_Classifiers_ch03.html" class="pagination-link" aria-label="A Tour of Machine Learning Classifiers Using Scikit-Learn">
        <span class="nav-page-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">A Tour of Machine Learning Classifiers Using Scikit-Learn</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Copyright 2024, Juergen Jung</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://juejung.github.io/">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>
<script>var lightboxQuarto = GLightbox({"closeEffect":"zoom","descPosition":"bottom","loop":false,"openEffect":"zoom","selector":".lightbox"});
(function() {
  let previousOnload = window.onload;
  window.onload = () => {
    if (previousOnload) {
      previousOnload();
    }
    lightboxQuarto.on('slide_before_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      const href = trigger.getAttribute('href');
      if (href !== null) {
        const imgEl = window.document.querySelector(`a[href="${href}"] img`);
        if (imgEl !== null) {
          const srcAttr = imgEl.getAttribute("src");
          if (srcAttr && srcAttr.startsWith("data:")) {
            slideConfig.href = srcAttr;
          }
        }
      } 
    });
  
    lightboxQuarto.on('slide_after_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(slideNode);
      }
    });
  
  };
  
})();
          </script>




</body></html>